### 问题一技术框架

#### 一、技术框架整体架构
问题一的技术框架以“**原始数据→特征提取→有效特征输出**”为主线，涵盖**6大核心模块**，各模块功能与定位如下：
1. **源域数据输入与筛选模块**：负责加载源域原始振动数据（.mat文件），并基于轴承类型、故障类型、转速、故障直径的约束条件，筛选出具有代表性的样本数据集。
2. **样本属性补充模块**：对筛选后的样本，计算转速（赫兹）并补充轴承几何参数（滚动体数、滚动体直径、轴承节径），为特征频率计算提供基础输入。
3. **多域特征提取模块**：分**时域、频域、时频**三个子模块，分别提取反映故障冲击强度、频率标识、频带分布的特征，是故障敏感特征的核心生成环节。
4. **特征矩阵构建模块**：将多域特征整合为统一的特征向量，形成源域特征矩阵（161×15维），实现特征的结构化存储。
5. **特征选择模块**：采用ReliefF算法计算特征权重，筛选出区分能力最强的前10个有效特征，降低维度并聚焦关键信息。
6. **结果输出模块**：整理并输出筛选后的数据集、样本特征分析、源域特征矩阵及有效特征子集，为后续跨域迁移任务提供支撑。

#### 二、模块关系与数据流向
- **模块依赖关系**：源域数据输入与筛选模块是后续所有模块的基础，其输出的筛选数据集流入样本属性补充模块；补充后的数据集作为多域特征提取模块的输入；多域特征提取的结果（时域、频域、时频特征）进入特征矩阵构建模块；构建的特征矩阵流向特征选择模块；最终所有中间结果与最终有效特征由结果输出模块整合输出。
- **数据流向路径**：原始源域数据 → 源域数据输入与筛选模块 → 筛选后的数据集 → 样本属性补充模块 → 补充属性后的数据集 → 多域特征提取模块（时域→频域→时频） → 多域特征向量 → 特征矩阵构建模块 → 源域特征矩阵 → 特征选择模块 → 有效特征子集 → 结果输出模块 → 最终输出内容

#### 三、实际操作流程与关键要点
技术框架的实际应用需严格遵循“**输入→处理→运算→输出**”的逻辑，各环节的输入、输出及关键操作如下：

##### 1. 源域数据输入与筛选环节
- **输入**：161个源域.mat文件（含`time`、`acceleration`、`bearing_type`、`fault_type`、`fault_diameter`、`rpm`字段）、轴承几何参数表（`bearing_geometry_params.csv`）、故障频率公式表（`fault_frequency_formula.csv`）。
- **关键操作**：遍历每个样本，验证其属性是否满足约束条件（轴承类型∈{SKF6205, SKF6203}、故障类型∈{Healthy, Outer_Race, Inner_Race, Ball}、转速∈[1000, 3000]rpm、故障直径∈{0.007, 0.014, 0.021}英寸）。
- **输出**：筛选后的源域数据集\( \mathcal{S}' \)（仅保留符合所有约束的样本）。

##### 2. 样本属性补充环节
- **输入**：筛选后的数据集\( \mathcal{S}' \)、轴承几何参数表。
- **关键操作**：（1）计算转速（赫兹）：\( f_{r,i} = \frac{rpm_i}{60} \)（将“转/分钟”转换为“每秒旋转次数”）；（2）补充几何参数：根据轴承类型\( bt_i \)查询表格，赋值滚动体数\( n_i \)、滚动体直径\( d_i \)、轴承节径\( D_i \)（如SKF6205对应\( n_i=9 \)、\( d_i=0.3126 \)英寸、\( D_i=1.537 \)英寸）。
- **输出**：补充属性后的数据集（含\( f_r \)、\( n \)、\( d \)、\( D \)字段）。

##### 3. 多域特征提取环节
本环节分**时域、频域、时频**三个子环节，分别提取不同维度的故障敏感特征：

- **（1）时域特征提取**
  - **输入**：补充属性后的数据集、每个样本的离散振动加速度\( a_i[k] \)（48000个采样点）。
  - **关键操作**：计算5个时域统计特征（反映冲击强度）：
    - 峰值：\( \text{Peak}*i = \max*{k=1}^{48000} |a_i[k]| \)；
    - 均方根：\( \text{RMS}*i = \sqrt{\frac{1}{48000} \sum*{k=1}^{48000} a_i[k]^2} \)；
    - 峰值因子：\( \text{CrestFactor}_i = \frac{\text{Peak}_i}{\text{RMS}_i} \)；
    - 脉冲因子：\( \text{ImpulseFactor}_i = \frac{\text{Peak}*i}{\frac{1}{48000} \sum*{k=1}^{48000} |a_i[k]|} \)；
    - 峭度：\( \text{Kurtosis}*i = \frac{1}{48000} \sum*{k=1}^{48000} \left( \frac{a_i[k] - \mu_i}{\sigma_i} \right)^4 - 3 \)（\( \mu_i \)为均值，\( \sigma_i \)为标准差）。
  - **输出**：5维时域特征向量。

- **（2）频域特征提取**
  - **输入**：补充属性后的数据集、每个样本的\( a_i[k] \)、理论特征频率（BPFO/BPFI/BSF）。
  - **关键操作**：① 计算理论特征频率（对应故障类型）：
    - 外圈故障：\( \text{BPFO}*i = f*{r,i} \cdot \frac{n_i}{2} \cdot \left(1 - \frac{d_i}{D_i}\right) \)；
    - 内圈故障：\( \text{BPFI}*i = f*{r,i} \cdot \frac{n_i}{2} \cdot \left(1 + \frac{d_i}{D_i}\right) \)；
    - 滚动体故障：\( \text{BSF}*i = f*{r,i} \cdot \frac{D_i}{d_i} \cdot \left[ 1 - \left( \frac{d_i}{D_i} \right)^2 \right] \)；② 对\( a_i[k] \)做FFT得到频谱\( A_i(f) \)；③ 提取特征频率幅值：\( F_{f,i}^{\text{FF}} = \max\left\{ |A_i(f)| \mid f \in [\text{FF}*i - 1, \text{FF}*i + 1] \right\} \)（FF为理论特征频率）；④ 计算谐波总能量：\( E*{\text{harmonic},i} = \sum*{k=1}^3 |A_i(k \cdot \text{FF}_i)| \)（1~3次谐波幅值和）。
  - **输出**：4维频域特征向量（3个特征频率幅值+1个谐波总能量）。

- **（3）时频特征提取**
  - **输入**：补充属性后的数据集、每个样本的\( a_i[k] \)。
  - **关键操作**：① EMD分解：将\( a_i[k] \)分解为8个IMF（固有模态函数），舍弃最后1个趋势项，保留前6个IMF；② 计算IMF能量：\( E_{j,i} = \sum_{k=1}^{48000} |\text{imf}*{j,i}[k]|^2 \)（\( j=1~6 \)，第\( j \)个IMF的能量）；③ 归一化能量占比：\( F*{\text{emd},j,i} = \frac{E_{j,i}}{\sum_{m=1}^6 E_{m,i}} \)（前6个IMF能量占比之和为1）。
  - **输出**：6维时频特征向量（前6个IMF的能量占比）。

##### 4. 特征矩阵构建环节
- **输入**：每个样本的5维时域特征、4维频域特征、6维时频特征。
- **关键操作**：将多域特征组合为15维特征向量\( \mathbf{f}*i = \left[ \text{Peak}*i, \text{RMS}*i, \text{CrestFactor}*i, \text{ImpulseFactor}*i, \text{Kurtosis}*i, F*{f,i}^{\text{BPFO}}, F*{f,i}^{\text{BPFI}}, F*{f,i}^{\text{BSF}}, E*{\text{harmonic},i}, F*{\text{emd},1,i}, F*{\text{emd},2,i}, F_{\text{emd},3,i}, F_{\text{emd},4,i}, F_{\text{emd},5,i}, F_{\text{emd},6,i} \right]^T \)，并整合所有样本的特征向量形成161×15的源域特征矩阵。
- **输出**：源域特征矩阵（行对应样本，列对应特征）。

##### 5. 特征选择环节
- **输入**：源域特征矩阵、样本的故障类型标签\( ft_i \)。
- **关键操作**：采用ReliefF算法计算特征权重（区分能力）：（1）初始化权重\( W(f)=0 \)（\( f=1~15 \)，对应15维特征）；（2）随机选取50个样本（覆盖所有故障类型），对每个样本\( x_i \)：
  - 找5个同类近邻\( x_{h,l} \)（故障类型相同、特征距离最近）和5个异类近邻\( x_{m,l} \)（故障类型不同、特征距离最近）；
  - 更新权重：\( W(f) = W(f) - \frac{1}{50 \times 5} \sum_{l=1}^5 |x_i(f) - x_{h,l}(f)| + \frac{1}{50 \times 5} \sum_{l=1}^5 |x_i(f) - x_{m,l}(f)| \)；（3）按权重\( W(f) \)降序排序，选取前10个特征作为有效特征子集。
- **输出**：有效特征子集（10维，区分能力最强的特征）。

##### 6. 结果输出环节
- **输入**：筛选后的数据集\( \mathcal{S}' \)、样本特征分析（时域/频域/时频特征的统计分布）、源域特征矩阵、有效特征子集。
- **关键操作**：整理并输出所有结果，确保内容完整且可复现。
- **输出**：（1）筛选后的源域数据集（含补充的\( f_r \)、\( n \)、\( d \)、\( D \)字段）；（2）代表性样本的特征分析（如正常样本与故障样本的时域峰值对比、频域特征频率幅值差异）；（3）161×15的源域特征矩阵；（4）ReliefF算法筛选的有效特征子集（前10个高权重特征）。

#### 四、技术实现路径总结
问题一的技术实现路径可概括为：**“原始数据加载与筛选→属性补充→多域特征提取→特征矩阵构建→特征选择→结果输出”**。每个环节均严格对应数学模型的约束与公式，确保特征的有效性与可解释性——从原始振动信号到故障敏感特征的转化，核心是通过“时域（冲击强度）→频域（频率标识）→时频（频带分布）”的多维度特征整合，捕捉轴承故障的完整机理；再通过特征选择聚焦关键信息，为后续跨域迁移诊断奠定基础。
### 问题二技术框架

#### 一、技术框架整体架构
问题二的技术框架以**“时频局部特征提取-关联学习-性能评价”**为核心逻辑，围绕旋转机械故障诊断的全流程，划分为六大功能模块：**数据输入模块**、**EMD时频分解模块**、**IMF时域特征提取模块**、**数据预处理模块**（含分层抽样与特征归一化）、**EMD-CNN诊断模型模块**、**性能评价模块**。各模块通过“数据驱动-特征转换-模型学习-结果反馈”的链式关系，系统解决“全局特征无法捕捉局部故障信息”的局限性。

#### 二、模块功能与相互关系
1. **数据输入模块**：作为流程起点，负责加载原始振动信号与故障标签，为后续所有模块提供基础数据支撑；
2. **EMD时频分解模块**：接收原始振动信号，通过EMD算法的“筛选”过程将复杂信号分解为5个**固有模态函数（IMF）**（时频局部化分量，聚焦故障冲击）与1个残余分量（单调趋势项），实现故障信息的“局部化聚焦”；
3. **IMF时域特征提取模块**：接收EMD输出的IMF分量，提取每个IMF的5维时域特征（峰值、均方根、峰值因子、脉冲因子、峭度），将时频局部化的IMF转换为**量化的判别性特征**，形成25维组合特征矩阵；
4. **数据预处理模块**：分为“分层抽样”与“特征归一化”两个子步骤——分层抽样保持训练集与测试集的类别分布一致，避免样本偏斜；特征归一化消除量纲差异（如峰值单位为g、峰值因子无单位），使特征处于同一尺度；
5. **EMD-CNN诊断模型模块**：接收预处理后的特征数据，构建1D-CNN模型学习EMD-IMF特征间的关联关系（如IMF1的峭度与IMF2的峰值交互），输出故障类型的概率分布；
6. **性能评价模块**：接收模型的预测结果与测试集真实标签，通过多指标（准确率、精确率、召回率、F1-score、混淆矩阵）量化诊断性能，反馈模型效果。

**模块依赖关系**：数据输入模块为EMD分解模块提供原始数据；EMD分解模块的输出（IMF分量）流入IMF特征提取模块；特征提取后的组合特征进入数据预处理模块；预处理后的高质量特征输入EMD-CNN模型模块进行训练与预测；模型的预测结果最终进入性能评价模块生成诊断结论。

#### 三、数据流向
原始振动信号矩阵\(\mathbf{S}\) + 故障标签向量\(\mathbf{y}\) → EMD时频分解模块（输出IMF分量集合） → IMF时域特征提取模块（输出25维特征矩阵\(\mathbf{X}\)） → 数据预处理模块（分层抽样→特征归一化，输出标准化训练/测试集） → EMD-CNN诊断模型模块（训练模型→输出预测概率\(\mathbf{y}*{\text{pred_prob}}\)与预测类别\(\mathbf{y}*{\text{pred}}\)） → 性能评价模块（输出诊断性能指标）。

#### 四、实际操作流程（与数学模型一一对应）
1. **数据输入环节**：
   - 输入：`Source_Vibration_Signals.csv`数据集；
   - 关键操作：读取文件并提取161个样本的振动信号时间序列（形成\(\mathbf{S} \in \mathbb{R}^{161 \times 1024}\)，每行为1个样本的1024个采样点）与故障标签（形成\(\mathbf{y} \in \mathbb{N}^{161 \times 1}\)，\(y_i \in \{0,1,2,3\}\)对应“正常、内圈故障、外圈故障、滚动体故障”）；
   - 输出：原始振动信号矩阵\(\mathbf{S}\)与故障标签向量\(\mathbf{y}\)。

2. **EMD时频分解环节**：
   - 输入：原始振动信号矩阵\(\mathbf{S}\)；
   - 关键操作：使用PyEMD库的`EMD`类（设置`max_imf=5`，筛选停止准则为“包络均值绝对值≤0.01g”且“极值点数量与过零点数量差≤1”），对每个样本的振动信号进行分解，得到5个IMF分量与1个残余分量；
   - 输出：每个样本的IMF集合`imfs_list`（`imfs_list[i]`为第\(i\)个样本的5×1024 IMF矩阵）。

3. **IMF时域特征提取环节**：
   - 输入：`imfs_list`；
   - 关键操作：通过自定义函数`extract_features`计算每个IMF的5维时域特征——峰值（\(\text{Peak}*{i,m} = \max|\mathbf{c}*{i,m}(t)|\)）、均方根（\(\text{RMS}*{i,m} = \sqrt{\frac{1}{1024}\sum \mathbf{c}*{i,m}(t)^2}\)）、峰值因子（\(\text{CrestFactor}*{i,m} = \frac{\text{Peak}*{i,m}}{\text{RMS}*{i,m}}\)）、脉冲因子（\(\text{ImpulseFactor}*{i,m} = \frac{\text{Peak}*{i,m}}{\frac{1}{1024}\sum |\mathbf{c}*{i,m}(t)|}\)）、峭度（\(\text{Kurtosis}*{i,m} = \frac{1}{1024}\sum (\frac{\mathbf{c}*{i,m}(t)-\mu_{i,m}}{\sigma_{i,m}})^4 - 3\)），并将5个IMF的特征拼接为25维向量；
   - 输出：源域特征矩阵\(\mathbf{X} \in \mathbb{R}^{161 \times 25}\)。

4. **数据预处理环节**：
   - **分层抽样**：
     - 输入：\(\mathbf{X}\)与\(\mathbf{y}\)；
     - 关键操作：使用`StratifiedShuffleSplit`（训练集占70%、测试集占30%，`random_state=42`）按类别比例抽样，保证训练集与测试集的类别分布一致；
     - 输出：训练集\(\mathbf{X}*{\text{train}} \in \mathbb{R}^{113 \times 25}\)、\(\mathbf{y}*{\text{train}} \in \mathbb{N}^{113 \times 1}\)，测试集\(\mathbf{X}*{\text{test}} \in \mathbb{R}^{48 \times 25}\)、\(\mathbf{y}*{\text{test}} \in \mathbb{N}^{48 \times 1}\)。
   - **特征归一化**：
     - 输入：训练集\(\mathbf{X}_{\text{train}}\)；
     - 关键操作：使用`StandardScaler`计算训练集特征的均值\(\mu_f = \frac{1}{113}\sum \mathbf{X}*{\text{train}}[i,f]\)与方差\(\sigma_f = \sqrt{\frac{1}{113}\sum (\mathbf{X}*{\text{train}}[i,f]-\mu_f)^2}\)，并通过\(x_{\text{scaled}} = \frac{x - \mu_f}{\sigma_f}\)标准化训练集与测试集（复用训练集统计量避免数据泄漏）；
     - 输出：标准化训练集\(\mathbf{X}*{\text{train,scaled}}\)、标准化测试集\(\mathbf{X}*{\text{test,scaled}}\)。

5. **EMD-CNN诊断模型环节**：
   - **模型构建**：
     - 输入：标准化特征的形状\((25,1)\)（25维特征序列+1通道，适配1D-CNN）；
     - 关键操作：构建序列模型：`Input(shape=(25,1))`→`Conv1D(64, 5, activation='relu')`（1D卷积层，64通道、核大小5）→`MaxPooling1D(2)`（最大池化层，窗口2）→`Flatten()`（扁平化层，将10×64特征转换为640维向量）→`Dense(64, activation='relu')`（全连接层，压缩特征）→`Dense(4, activation='softmax')`（输出层，4类故障概率）；
   - **模型训练**：
     - 输入：\(\mathbf{X}*{\text{train,scaled}}\)与\(\mathbf{y}*{\text{train}}\)；
     - 关键操作：使用Adam优化器（学习率0.001）、稀疏交叉熵损失（适配整数标签）、100轮迭代（`epochs=100`）、批量大小32（`batch_size=32`）训练模型，并用10%的训练集作为验证集监控过拟合；
   - **模型预测**：
     - 输入：\(\mathbf{X}_{\text{test,scaled}}\)；
     - 关键操作：通过模型输出测试集的故障概率分布\(\mathbf{y}*{\text{pred_prob}}\)，并取概率最大值（\(\arg\max_k \mathbf{y}*{\text{pred_prob}}[i,k]\)）作为预测类别\(\mathbf{y}_{\text{pred}}\)；
   - 输出：故障概率分布\(\mathbf{y}*{\text{pred_prob}}\)、预测类别\(\mathbf{y}*{\text{pred}}\)。

6. **性能评价环节**：
   - 输入：测试集真实标签\(\mathbf{y}*{\text{test}}\)、预测类别\(\mathbf{y}*{\text{pred}}\)；
   - 关键操作：
     - 准确率：\(\text{Accuracy} = \frac{1}{48}\sum \mathbb{I}(\arg\max_k \mathbf{y}*{\text{pred,test}}[i,k] = y*{\text{test}}[i])\)（正确分类样本比例）；
     - 精确率：\(\text{Precision}_k = \frac{TP_k}{TP_k + FP_k}\)（预测为\(k\)类的样本中实际为\(k\)类的比例）；
     - 召回率：\(\text{Recall}_k = \frac{TP_k}{TP_k + FN_k}\)（实际为\(k\)类的样本中被正确预测的比例）；
     - F1-score：\(\text{F1}_k = 2 \cdot \frac{\text{Precision}_k \cdot \text{Recall}_k}{\text{Precision}_k + \text{Recall}_k}\)（精确率与召回率的调和平均）；
     - 混淆矩阵：\(\text{CM}[k,j] = \sum \mathbb{I}(y_{\text{test}}[i]=k \land \arg\max_l \mathbf{y}_{\text{pred,test}}[i,l]=j)\)（可视化分类错误）；
   - 输出：分类报告（含准确率、精确率、召回率、F1-score）、混淆矩阵。

#### 五、技术框架总结
该框架通过“EMD分解→IMF特征提取→CNN关联学习”的全流程，实现了“局部故障信息捕捉-特征量化-关联学习”的闭环：EMD分解将全局信号转换为局部化的IMF，IMF特征提取将时频信息量化为判别性特征，CNN模型学习特征间的关联关系，最终通过多指标评价验证诊断性能。各模块的设计均贴合旋转机械故障诊断的物理本质（故障冲击的时频局部性）与机器学习的工程逻辑（特征标准化、分层抽样、关联学习），确保模型能精准捕捉故障的细微特征差异。
### 问题三技术框架说明

#### 一、技术框架整体架构
问题三的技术框架围绕“**源域知识迁移至目标域**”的核心目标，划分为6个核心模块，各模块功能如下：
1. **输入准备与参数初始化模块**：负责加载源域已标注特征数据、目标域原始振动信号数据及辅助参数表格（轴承几何参数、故障频率公式），并初始化DANN模型的结构参数（特征提取器、标签分类器、域分类器的网络层数、激活函数）与超参数（学习率、迭代次数、批次大小等）。
2. **目标域特征提取与标准化模块**：将目标域原始振动加速度信号转换为与源域一致的13维特征（时域5维、频域3维、时频4维），并利用源域特征的统计量（均值、标准差）对目标域特征进行标准化，消除尺度差异。
3. **DANN模型构建模块**：搭建领域对抗神经网络的核心组件——特征提取器\( G \)（捕捉域不变特征）、标签分类器\( C \)（继承源域故障分类能力）、域分类器\( D \)（判别特征域归属），并通过梯度反转层（GRL）连接特征提取器与域分类器，实现域对抗机制。
4. **DANN联合训练模块**：以“**分类任务保留共性、域对抗任务减少差异**”为目标，通过mini-batch随机梯度下降优化模型参数：标签分类器最小化源域分类损失，域分类器最小化域判别损失，特征提取器通过GRL反转梯度，同时最小化分类损失、最大化域判别损失。
5. **目标域分类标定模块**：利用训练好的DANN模型，将目标域标准化特征映射至域不变特征空间，通过标签分类器输出故障概率，取概率最大的类别作为目标域样本的最终故障标签。
6. **结果输出与可视化模块**：输出目标域特征矩阵、训练后的模型参数、目标域分类结果，并通过损失曲线（反映训练收敛性）、PCA散点图（展示域不变特征的分布偏移减少效果）、置信度分布（衡量分类结果的可靠性）可视化迁移效果。

#### 二、模块关系与数据流向
1. **模块关系**：输入准备模块为特征提取模块提供原始数据与初始化参数；特征提取模块将处理后的标准化特征输入模型构建模块；模型构建模块生成的DANN架构进入训练模块进行参数优化；训练后的模型参数流入分类标定模块用于目标域标签预测；分类结果与中间数据最终传递至输出模块完成展示。
2. **数据流向**：原始源域特征/目标域信号 → 输入准备与参数初始化 → 目标域特征提取与标准化 → DANN模型构建 → DANN联合训练 → 目标域分类标定 → 结果输出与可视化

#### 三、实际操作流程与关键要点
以下结合问题求解的具体步骤，细化各环节的**输入、关键操作、输出**：

1. **输入准备与参数初始化环节**
   - **输入**：源域特征文件（`Source_Features.csv`，含\( X_s \)、\( y_s \)）、目标域16个`.mat`文件（含振动信号\( t_j^{\text{acc}} \)、轴承类型\( t_j^{\text{bt}} \)、转速\( t_j^{\text{rpm}} \)）、辅助表格（`bearing_geometry_params.csv`、`fault_frequency_formula.csv`）。
   - **关键操作**：加载源域特征与标签，读取目标域原始信号与属性，查询轴承几何参数；初始化模型结构（特征提取器\( G \)为13→64→64 ReLU、标签分类器\( C \)为64→4 Softmax、域分类器\( D \)为64→32→1 Sigmoid），设置超参数（学习率\( lr=0.001 \)、迭代次数\( epochs=100 \)、批次大小\( batch_size=32 \)、域对抗系数\( \lambda = \text{current_epoch}/100 \)）。
   - **输出**：加载完成的源域/目标域数据、初始化的DANN模型参数。

2. **目标域特征提取与标准化环节**
   - **输入**：目标域原始振动信号\( t_j^{\text{acc}} \)、轴承类型\( t_j^{\text{bt}} \)、转速\( t_j^{\text{rpm}} \)、轴承几何参数表格。
   - **关键操作**：
     - 时域特征计算：通过\( \text{Peak}*j = \max(t_j^{\text{acc}}) \)、\( \text{RMS}*j = \sqrt{\frac{1}{N}\sum*{k=1}^N a*{j,k}^2} \)等公式计算峰值、均方根、峰值因子、脉冲因子、峭度；
     - 频域特征计算：先通过\( \text{BPFO}_j = t_j^{\text{fr}} \cdot \frac{t_j^{\text{n}}}{2} \cdot (1 - \frac{t_j^{\text{d}}}{t_j^{\text{D}}}) \)等公式计算理论故障频率，再对振动信号做FFT，取理论频率±5%范围内的最大幅值作为频域特征；
     - 时频特征计算：用db4小波对振动信号做2层分解，计算4个节点的能量占比；
     - 特征标准化：利用源域特征的均值\( \mu_{s,f} \)与标准差\( \sigma_{s,f} \)，通过\( X_{t,\text{scaled}}[j,f] = \frac{X_t[j,f] - \mu_{s,f}}{\sigma_{s,f}} \)将目标域特征转换为零均值、单位方差分布。
   - **输出**：与源域一致的目标域13维特征矩阵\( X_t \)、标准化后的目标域特征矩阵\( X_{t,\text{scaled}} \)。

3. **DANN模型构建环节**
   - **输入**：源域/目标域特征维度（13维输入、64维域不变特征、4类故障输出）。
   - **关键操作**：
     - 特征提取器\( G \)：定义2层全连接网络，前向传播公式为\( z = \text{ReLU}(W_2 \cdot \text{ReLU}(W_1 x + b_1) + b_2) \)；
     - 标签分类器\( C \)：定义1层全连接网络，前向传播公式为\( p = \text{Softmax}(W_c z + b_c) \)；
     - 域分类器\( D \)：定义2层全连接网络，前向传播公式为\( q = \text{Sigmoid}(W_{d2} \cdot \text{ReLU}(W_{d1} \cdot \text{GRL}(z) + b_{d1}) + b_{d2}) \)；
     - GRL层：前向传播恒等映射（\( \text{GRL}(z) = z \)），反向传播时梯度乘以\(-\lambda\)。
   - **输出**：完整的DANN网络结构（含\( G \)、\( C \)、\( D \)与GRL的连接关系）。

4. **DANN联合训练环节**
   - **输入**：源域特征矩阵\( X_s \)、源域标签\( y_s \)、目标域标准化特征\( X_{t,\text{scaled}} \)、初始化的DANN模型参数。
   - **关键操作**：
     - 数据加载与批次生成：随机打乱源域数据，按\( batch_size=32 \)生成源域mini-batch；目标域数据按相同批次大小生成mini-batch（不足时重复采样）；
     - 前向传播：源域样本通过\( G \)生成域不变特征\( z_s \)，输入\( C \)得到分类概率\( p_s \)，输入\( D \)（经GRL）得到域概率\( q_s \)；目标域样本通过\( G \)生成\( z_t \)，输入\( D \)得到\( q_t \)；
     - 损失计算：分类损失\( L_{\text{cls}} = -\frac{1}{M} \sum_{i=1}^M \sum_{k=0}^3 y_{s,i,k} \log(p_{s,i,k}) \)，域损失\( L_{\text{dom}} = -\frac{1}{M+K} \left( \sum_{i=1}^M \log(q_{s,i}) + \sum_{j=1}^K \log(1 - q_{t,j}) \right) \)，总损失\( L_{\text{total}} = L_{\text{cls}} + L_{\text{dom}} \)；
     - 梯度计算与参数更新：标签分类器\( C \)仅优化\( L_{\text{cls}} \)，域分类器\( D \)仅优化\( L_{\text{dom}} \)，特征提取器\( G \)通过\(
       abla_G L_{\text{total}} =
       abla_G L_{\text{cls}} - \lambda
       abla_G L_{\text{dom}} \)优化（GRL反转域损失梯度）；
     - 迭代训练：重复上述步骤100次，每轮更新\( \lambda = \text{current_epoch}/100 \)（线性递增，平衡分类与域对抗优先级）。
   - **输出**：训练收敛的DANN模型参数（\( G \)、\( C \)、\( D \)的权重与偏置）。

5. **目标域分类标定环节**
   - **输入**：训练好的DANN模型参数、目标域标准化特征\( X_{t,\text{scaled}} \)。
   - **关键操作**：
     - 特征投影：将\( X_{t,\text{scaled}} \)输入\( G \)，得到目标域的域不变特征矩阵\( Z_t = G(X_{t,\text{scaled}}) \)；
     - 故障预测：将\( Z_t \)输入\( C \)，得到4类故障概率矩阵\( P_t = C(Z_t) \)；
     - 分类标定：对每个目标域样本\( j \)，通过\( y_{t,j} = \arg\max_{k \in \{0,1,2,3\}} P_{t,j,k} \)取概率最大的类别作为故障标签。
   - **输出**：目标域16个样本的故障标签向量\( y_t \)。

6. **结果输出与可视化环节**
   - **输入**：目标域特征矩阵\( X_t \)、训练后的模型参数、目标域分类结果\( y_t \)、训练过程的损失记录、域不变特征矩阵\( Z_s \)（源域）与\( Z_t \)（目标域）。
   - **关键操作**：
     - 数值输出：保存\( X_t \)、模型参数、\( y_t \)至文件；
     - 可视化：绘制训练过程的\( L_{\text{cls}} \)与\( L_{\text{dom}} \)曲线（观察收敛性）；对\( Z_s \)与\( Z_t \)做PCA降维，绘制散点图（源域用真实标签着色，目标域用预测标签着色，观察域分布重叠度提升）；绘制目标域样本的分类概率直方图（展示置信度分布）。
   - **输出**：目标域分类结果文件、模型参数文件、迁移效果可视化图。

该技术框架完整覆盖了“**从原始数据到目标域分类**”的全流程，通过模块化设计明确了各环节的核心任务与依赖关系，同时通过具体公式与操作要点，为实际实现提供了可落地的路径指南。
