### 问题一求解思路阐述

#### 一、核心需求与实现关键点
问题一的核心目标是从源域轴承振动数据中提取**可区分故障类型的多域特征**，并筛选有效特征以支撑后续跨域故障诊断的迁移任务。源域数据包含两类轴承（SKF6205、SKF6203）的正常状态与三类故障（外圈、内圈、滚动体）数据，需通过特征提取将原始振动信号转化为量化指标，实现故障类型的有效区分。

**实现关键点**包括：
1. **多域特征协同**：单一域特征（如仅时域或频域）难以全面捕捉故障特性，需结合时域（冲击强度）、频域（频率标识）、时频域（频带分布）多维度特征，形成“冲击-频率-频带”的完整特征链；
2. **特征有效性保障**：提取的特征需与故障机理直接关联（如冲击强度反映故障严重程度，特征频率是故障“指纹”），避免无关特征干扰；
3. **特征降维筛选**：多域特征可能存在冗余，需通过算法筛选区分能力最强的特征子集，降低后续迁移任务的复杂度。

#### 二、数据与基础信息准备
**核心数据**包括：
- **源域振动数据集**：含161个样本，每个样本为4秒离散振动加速度信号（采样频率12000Hz，采样点数48000），并标注轴承类型（SKF6205/SKF6203）、故障类型（正常/外圈/内圈/滚动体）、转速（1000-3000rpm）、故障直径（0.007/0.014/0.021英寸）；
- **轴承几何参数**：从制造商数据中获取两类轴承的固定参数（滚动体数均为9，SKF6205滚动体直径0.3126英寸、节径1.537英寸；SKF6203对应0.2656英寸、1.122英寸），用于计算故障特征频率。

**关键参数设置**：
- 时域窗口：完整4秒信号（覆盖至少2个旋转周期，确保捕捉完整冲击模式）；
- FFT参数：采样点数48000，频率分辨率0.25Hz（足够分辨特征频率谐波）；
- EMD参数：分解为8个固有模态函数（IMF），保留前6个IMF（覆盖故障冲击核心频带）。

#### 三、约束条件与模型假设
为确保特征提取的有效性，需满足以下约束：
1. **数据有效性约束**：样本需覆盖所有故障类型（4类）、轴承类型（2类）、转速（1000-3000rpm）及故障直径（3种），避免样本偏差；
2. **几何参数匹配约束**：滚动体数、直径、节径需与轴承类型严格对应（如SKF6205的节径必须为1.537英寸），否则特征频率计算误差将超过20%；
3. **特征频率计算约束**：故障特征频率（如外圈BPFO、内圈BPFI、滚动体BSF）需基于转速和几何参数推导，反映滚动体与故障点的碰撞周期；
4. **特征提取规则约束**：时域特征需用完整4秒信号计算（避免窗口过短丢失冲击周期），频域特征需取理论频率±1Hz范围的最大幅值（应对噪声导致的频率偏移），时频特征能量占比需归一化（消除信号强度差异，聚焦频带分布）。

**模型假设**：深沟球轴承接触角为0（简化特征频率计算，误差≤5%），采样频率准确（无需校准），故障直径影响通过归一化特征消除（如能量占比、峰值因子）。

#### 四、多域特征提取模型
基于故障机理，从三个维度构建特征：

##### 1. 时域特征：量化冲击强度
故障会导致轴承振动产生周期性冲击，时域特征通过统计量描述冲击的强度与分布：
- **峰值**：信号最大绝对值，反映单次冲击的最大强度（故障信号峰值显著高于正常信号）；
- **均方根（RMS）**：信号能量的量化指标，故障时摩擦加剧，RMS值升高；
- **峰值因子**：峰值与RMS的比值，反映冲击的突变性（故障信号因尖峰突出，峰值因子可从正常的3升至5以上）；
- **脉冲因子**：峰值与绝对均值的比值，聚焦脉冲成分的相对强度；
- **峭度**：信号陡峭程度的度量，正常信号峭度约为0（高斯分布），故障信号因冲击尖峰，峭度显著大于0（如内圈故障时可升至2以上）。

##### 2. 频域特征：捕捉频率标识
故障冲击具有周期性，会在频域产生特定“特征频率”（故障类型的“指纹”），需提取：
- **特征频率幅值**：基于几何参数和转速计算理论特征频率（如外圈故障BPFO、内圈BPFI、滚动体BSF），取频谱中理论频率±1Hz范围内的最大幅值（应对实际信号的频率偏移）；
- **谐波总能量**：特征频率1-3次谐波的幅值之和，故障冲击会激发丰富谐波（正常信号谐波能量极低），谐波越丰富，故障越明显。

##### 3. 时频特征：刻画频带分布
轴承振动信号为非线性非平稳信号，时频特征通过经验模态分解（EMD）自适应提取频带能量分布：
- **EMD分解**：将振动信号分解为8个IMF（从高频到低频排序），保留前6个IMF（舍弃低频趋势项）；
- **能量占比**：计算每个IMF的能量占总能量的比例，不同故障类型的冲击频带不同（如外圈故障冲击集中在高频IMF，内圈故障集中在中频IMF），能量占比可量化这种差异。

#### 五、特征整合与筛选模型
**特征矩阵构建**：将上述5个时域特征、4个频域特征（3类故障频率幅值+1个谐波能量）、6个时频特征（6个IMF能量占比）整合为每个样本的15维特征向量，形成161×15的特征矩阵。

**特征筛选**：采用ReliefF算法筛选有效特征。该算法通过比较样本与其同类/异类近邻的特征差异，计算特征的“区分权重”（权重越高，特征对故障类型的区分能力越强）。具体步骤为：随机选取50个样本（覆盖所有故障类型），对每个样本找5个同类近邻和5个异类近邻，通过特征差异更新权重，最终按权重降序选取前10个特征作为有效子集。

#### 六、求解算法与步骤
**求解流程**如下：

##### 步骤1：数据筛选
遍历源域样本，保留属性满足约束的样本（轴承类型为SKF6205/SKF6203，故障类型为4类之一，转速1000-3000rpm，故障直径为3种之一），确保样本具有代表性。

##### 步骤2：参数补充与特征频率计算
- 补充几何参数：根据轴承类型匹配滚动体数、直径、节径；
- 计算转速（Hz）：将转速（rpm）转换为每秒旋转次数（rpm/60）；
- 计算理论特征频率：基于几何参数和转速，分别计算外圈（BPFO）、内圈（BPFI）、滚动体（BSF）的理论频率（如SKF6205在1797rpm时，BPFO约为107Hz）。

##### 步骤3：时域特征计算
对每个样本的4秒振动信号，按定义计算峰值、RMS、峰值因子、脉冲因子、峭度5个特征。

##### 步骤4：频域特征计算
- 对振动信号做FFT变换，得到频域频谱；
- 提取特征频率幅值：在理论特征频率±1Hz范围内取最大幅值；
- 计算谐波总能量：累加特征频率1-3次谐波的幅值。

##### 步骤5：时频特征计算
- 对振动信号做EMD分解，得到8个IMF，保留前6个；
- 计算每个IMF的能量（平方和），并归一化为能量占比（各IMF能量占比之和为1）。

##### 步骤6：特征矩阵与筛选
- 整合多域特征为15维向量，形成特征矩阵；
- 用ReliefF算法计算特征权重，选取前10个高权重特征作为有效子集。

#### 七、求解结果
通过上述流程，最终得到：
1. **筛选后的源域数据集**：覆盖所有故障类型和参数范围的有效样本，确保特征提取的普适性；
2. **161×15特征矩阵**：每个样本的多域特征量化值，全面反映故障的冲击强度、频率标识、频带分布；
3. **有效特征子集**：ReliefF算法筛选出的10个高区分度特征（如峰值因子、峭度、BPFO幅值、高频IMF能量占比等），可直接用于后续跨域故障诊断的迁移任务，支撑故障类型的精准区分。

综上，问题一通过多域特征提取与筛选，构建了故障敏感的量化指标体系，为跨域迁移诊断奠定了核心基础。
### 问题二求解思路阐述

#### 一、核心需求与实现关键点
问题二针对旋转机械（如轴承）的源域故障诊断任务，核心矛盾在于**传统全局特征（如直接对原始信号提取特征）难以捕捉局部故障冲击信息**，导致诊断准确性受限。因此，核心需求是通过**时频局部化分解**与**关联特征学习**结合的方式，精准提取故障冲击特征并建模其内在关联，最终提升故障诊断性能。

实现关键点包括三方面：
1. **局部故障冲击捕捉**：利用EMD（经验模态分解）的时频局部化特性，将复杂振动信号分解为包含故障冲击的IMF（固有模态函数）分量，避免全局特征对局部细节的掩盖；
2. **判别性特征提取**：从IMF分量中提取对故障冲击敏感的时域特征（如峰值、能量分布等），量化故障引起的信号变化；
3. **特征关联学习**：通过CNN（卷积神经网络）学习不同IMF特征间的交互关系（如不同频段冲击特征的关联性），提升模型对复杂故障模式的识别能力。

#### 二、数据与变量参数说明
**1. 输入数据**核心数据为`Source_Vibration_Signals.csv`，包含161个样本的原始振动信号，每个样本为1024个采样点的时间序列（单位：g），标签对应4类故障状态：正常（0）、内圈故障（1）、外圈故障（2）、滚动体故障（3）。

**2. 关键变量**
- **原始振动信号**：每个样本为1024点的时间序列，反映机械运行时的振动状态；
- **IMF分量**：EMD分解后得到的5个时频局部化分量，故障冲击主要集中在这些分量中，残余分量为单调趋势项（无故障信息）；
- **IMF时域特征向量**：每个IMF提取5维特征（峰值、RMS、峰值因子、脉冲因子、峭度），反映冲击强度、能量分布及分布形态；
- **源域特征矩阵**：每个样本的5个IMF特征组合为25维向量（5 IMF×5特征），作为模型输入；
- **模型输出**：4类故障的概率分布（每个样本属于某类故障的概率）。

**3. 核心参数**
- **EMD分解参数**：IMF数量固定为5（故障冲击集中在前5个IMF，残余分量单调），分解停止准则为“包络均值绝对值≤0.01g”且“极值点数量与过零点数量差≤1”（确保IMF满足时频局部化定义）；
- **特征提取参数**：5维时域特征（峰值反映瞬时冲击强度，RMS反映平均能量，峰值因子和脉冲因子对周期性冲击敏感，峭度反映分布陡峭程度，故障时特征值显著变化）；
- **数据处理参数**：训练集占比70%、测试集30%（分层抽样保持类别分布一致），特征标准化为“均值0、方差1”（消除量纲差异）；
- **CNN超参数**：输入形状(25,1)（25维特征序列+1通道），卷积层（核大小5、64通道、ReLU激活），池化层（最大池化窗口2），全连接层（640→64→4），优化器Adam（学习率0.001），损失函数交叉熵，训练轮次100，批大小32。

#### 三、约束条件
为保证模型有效性与稳定性，需满足以下约束：
1. **EMD分解一致性**：每个样本必须分解为5个IMF，确保所有样本的特征维度统一为25维（5 IMF×5特征），避免因分解分量数量差异导致模型输入维度混乱；
2. **特征完整性**：每个IMF必须提取5维时域特征，缺一不可——若某IMF特征缺失，会丢失该频段的故障信息，降低特征判别性；
3. **样本分布一致性**：训练集与测试集需通过分层抽样保持类别分布一致（如“正常”类样本占比在训练/测试集中相同），避免因样本偏斜导致模型对少数类故障识别能力下降；
4. **特征尺度统一性**：所有特征必须标准化处理（均值0、方差1）——不同特征量纲差异大（如峰值单位为g，峰值因子无单位），未标准化会导致CNN对量纲大的特征过度关注，忽略关键小量纲特征。

#### 四、数学模型构建逻辑
模型构建遵循“信号分解→特征提取→数据处理→关联学习→性能评价”的全流程逻辑，各环节紧密衔接以解决核心矛盾：

**1. EMD分解模型**将原始振动信号分解为IMF与残余分量，聚焦局部故障冲击。通过“筛选过程”（反复拟合信号上下包络、计算包络均值、迭代消除趋势项），将含全局信息的复杂信号拆解为5个时频局部化的IMF——故障冲击（如轴承外圈故障的周期性冲击）会集中在特定IMF中（通常为前3-4个高频IMF），残余分量为单调趋势（无故障信息），从而实现“全局信号→局部冲击特征”的转化。

**2. IMF特征提取模型**从每个IMF中提取5维时域特征，量化故障冲击特性。故障会改变IMF的冲击强度（峰值增大）、能量分布（RMS变化）及分布形态（峭度升高），这些特征对冲击敏感——例如，滚动体故障时，对应IMF的峰值因子和脉冲因子会显著大于正常状态，通过5维特征组合可有效区分不同故障类型。

**3. 数据划分与归一化模型**
- **分层抽样划分**：按70%-30%比例分层抽取训练/测试集，确保每个故障类别的样本在两集中占比一致（如“正常”类样本共N个，训练集取0.7N个，测试集取0.3N个），避免模型因某类样本过多/过少而学习偏差；
- **标准化处理**：用训练集的均值和方差对所有特征标准化，使不同量纲的特征处于同一尺度（如峰值从“g”转换为无量纲的标准分数），确保CNN对所有特征公平赋权，避免量纲主导模型学习。

**4. EMD-CNN诊断模型**通过1D-CNN学习IMF特征间的关联，输出故障概率。模型结构设计贴合特征特性：
- **卷积层**：用核大小5的1D卷积提取相邻5个特征的局部关联（如IMF1的峭度与IMF2的峰值是否存在协同变化，反映故障冲击在不同频段的传播规律）；
- **池化层**：最大池化保留局部最大值（筛选最具判别性的关联特征），降低计算量；
- **全连接层**：压缩特征维度并通过Softmax输出4类故障概率，实现“特征关联→故障分类”的映射。

**5. 模型训练与评价模型**
- **训练优化**：采用交叉熵损失量化预测概率与真实标签的差异（对错误预测惩罚更显著），Adam优化器自适应调整学习率（结合动量和梯度平方移动平均，保证收敛稳定性）；
- **性能评价**：通过准确率（整体分类正确比例）、精确率（预测为某类的样本中真实属于该类的比例）、召回率（真实某类样本中被正确预测的比例）、F1-score（精确率与召回率的调和平均）及混淆矩阵（可视化类别混淆情况），全面量化模型诊断能力。

#### 五、求解算法与步骤
基于上述模型，求解过程分为6步，严格依托Python工具链实现：

**1. 数据准备**读取`Source_Vibration_Signals.csv`，提取161个样本的振动信号（1024点/样本）及对应标签（4类故障），构建原始信号矩阵与标签向量。

**2. EMD分解**使用PyEMD库对每个样本信号执行EMD分解：设置IMF数量为5，按“包络均值≤0.01g”和“极值点-过零点差≤1”的准则停止筛选，得到5个IMF分量（忽略残余分量）。例如，正常样本的IMF能量分布较均匀，而内圈故障样本的前2个IMF能量显著高于其他分量。

**3. IMF特征提取**对每个IMF分量，通过自定义函数计算5维时域特征：遍历IMF的1024个采样点，计算峰值（绝对值最大值）、RMS（平方均值开方）、峰值因子（峰值/RMS）、脉冲因子（峰值/绝对值均值）、峭度（四阶中心矩除以标准差四次方再减3），组合为25维样本特征矩阵（161样本×25特征）。

**4. 数据划分与归一化**
- **分层抽样**：用`StratifiedShuffleSplit`按70%-30%比例划分训练集（113样本）和测试集（48样本），确保两集类别分布与原始数据一致（如原始数据中“正常”类占20%，训练/测试集均占20%）；
- **标准化**：用`StandardScaler`对训练集特征拟合（计算均值和方差）并标准化，再用训练集的统计量对测试集特征标准化，避免数据泄漏。

**5. EMD-CNN模型构建与训练**用Keras构建1D-CNN：
- 输入层接收(25,1)的特征序列；
- 卷积层用64个核大小5的卷积核提取局部关联特征（输出形状(21,64)，25-5+1=21）；
- 池化层用窗口2的最大池化降维（输出形状(10,64)，21//2=10）；
- 扁平化层将(10,64)转换为640维向量；
- 全连接层（640→64→4）压缩特征并通过Softmax输出概率；
- 编译模型（Adam优化器、交叉熵损失、准确率指标），用训练集训练100轮（批大小32，10%训练集作为验证集监控过拟合）。

**6. 模型评价与结果输出**
- **预测**：用测试集特征预测故障概率，取概率最大的类别为预测标签；
- **评价**：计算准确率、精确率、召回率、F1-score（通过`classification_report`）及混淆矩阵（通过`confusion_matrix`），输出量化结果（如准确率95%，各类F1-score均≥0.9）和可视化混淆矩阵（直观展示“外圈故障”是否易被误判为“滚动体故障”）。

#### 六、最终结果
求解后输出两类核心结果：
1. **故障概率分布**：每个测试样本的4类故障概率（如某样本输出[0.02, 0.03, 0.94, 0.01]，表明94%概率为外圈故障）；
2. **诊断性能指标**：包括整体准确率（反映模型综合能力）、4类故障的精确率/召回率/F1-score（评估对各类故障的识别精度）、混淆矩阵（展示每类故障的正确分类数与误分类数，如正常样本均正确分类，内圈故障有2个被误判为外圈故障）。

通过EMD捕捉局部冲击特征与CNN学习特征关联的结合，模型有效解决了全局特征的局限性，实现了高精度的源域故障诊断。

#### 总结
问题二通过“EMD时频局部化分解→IMF特征量化→CNN关联学习”的技术路线，系统性解决了全局特征无法捕捉局部故障信息的核心矛盾。各环节通过严格的变量定义、参数设置与约束条件保证有效性，最终输出的故障概率分布与多维度评价指标，为旋转机械源域故障诊断提供了精准、可解释的解决方案。
### 问题三求解思路阐述

#### 一、核心需求与实现关键点
问题三的核心需求是解决不同转速条件下的轴承故障诊断迁移学习问题。具体而言，需利用源域（已知故障标签、特定转速）的诊断模型，通过迁移学习适配目标域（未知标签、不同转速）的样本，实现对目标域16个未知标签样本的故障分类。其本质是**利用源域与目标域的共性特征，消除因转速差异导致的分布偏移**，关键在于构建能捕捉“域不变特征”（同时适用于源域与目标域的故障判别特征）的模型，并通过对抗机制减少“域分布差异”（源域与目标域特征分布的偏移）。

实现的核心关键点包括：
1. **共性特征的保留**：源域与目标域轴承类型（SKF6205/SKF6203）、特征维度（13维）、故障物理机制（故障频率计算、振动调制特性）一致，需通过严格一致的特征提取流程确保特征物理含义匹配，为迁移提供基础。
2. **差异特征的消除**：转速不同导致频域特征分布差异（如故障频率幅值随转速变化），需通过域对抗机制强制模型学习与转速无关的共性故障信息，减少分布偏移。
3. **无监督域适应的实现**：目标域样本无标签，需采用无监督迁移学习方法（DANN），利用源域标签监督特征学习，同时通过域分类器判别域归属，驱动特征提取器学习域不变特征。

#### 二、数据需求与预处理
模型构建需以下几类数据支撑，且需经过严格预处理以满足迁移学习条件：

**1. 源域数据**
- **特征矩阵**：包含161个有标签样本，每个样本提取13维特征，具体为：
  - **时域特征**（5维）：峰值、均方根（RMS）、峰值因子、脉冲因子、峭度，反映振动信号的幅度统计特性；
  - **频域特征**（3维）：外圈故障频率（BPFO）、内圈故障频率（BPFI）、滚动体故障频率（BSF）的幅值，反映故障的周期性振动频率成分；
  - **时频特征**（4维）：db4小波2层分解后的4个节点能量占比，反映故障信号的时频分布特性。
- **标签向量**：4类故障标签（0=正常、1=内圈故障、2=外圈故障、3=滚动体故障），用于监督标签分类器训练。

**2. 目标域数据**
- **原始信号**：16个样本的振动加速度时域信号（时长4秒，含N个采样点），需从中提取与源域一致的13维特征；
- **辅助参数**：每个样本的轴承类型（SKF6205/SKF6203）、转速（转/分钟）、几何参数（滚动体数量、滚动体直径、轴承节径），用于计算理论故障频率（BPFO/BPFI/BSF），支撑频域特征提取。

**3. 辅助数据**
- **轴承几何参数表**：记录SKF6205/SKF6203的滚动体数量、直径、节径，用于根据转速计算目标域样本的理论故障频率；
- **故障频率公式**：基于轴承几何参数与转速计算BPFO/BPFI/BSF的公式，确保频域特征的物理含义与源域一致。

**数据预处理关键**：目标域特征提取需严格复现源域流程，确保时域、频域、时频特征的计算方法完全相同（如频域特征需先计算理论故障频率，再提取对应频段的最大幅值），并通过源域特征的均值与标准差对目标域特征标准化，消除尺度差异。

#### 三、变量、参数与约束条件
模型的变量、参数设计需锚定“保留共性、减少差异”的目标，同时通过约束条件确保迁移合理性。

**1. 核心变量**
- **输入变量**：源域特征矩阵（161×13）及标签（161×1）、目标域原始振动信号及辅助参数（轴承类型、转速、几何参数）；
- **中间变量**：目标域特征矩阵（16×13，与源域同维度）、域不变特征（特征提取器输出的64维向量，过滤转速差异后的共性故障信息）；
- **输出变量**：目标域样本的预测故障标签（16×1，0-3四类）。

**2. 模型参数**
- **结构参数**：
  - **特征提取器（G）**：2层全连接网络（13→64→64），ReLU激活函数，用于将13维输入特征映射到64维域不变特征空间，平衡非线性捕捉能力与过拟合风险（源域样本量仅161，避免过深网络）；
  - **标签分类器（C）**：1层全连接网络（64→4），Softmax激活函数，输出4类故障概率，继承任务2的诊断能力；
  - **域分类器（D）**：2层全连接网络（64→32→1），Sigmoid激活函数，输出“源域/目标域”二分类概率，判别特征的域归属；
  - **梯度反转层（GRL）**：连接G与D，前向传播恒等映射，反向传播反转梯度，驱动G学习域不变特征。
- **超参数**：
  - 学习率0.001（Adam优化器默认值，平衡梯度稳定性与收敛速度）；
  - 迭代次数100（目标域样本仅16，避免过拟合）；
  - 批次大小32（源域161样本的合理mini-batch，兼顾梯度估计精度与训练速度）；
  - 域对抗系数λ（线性递增，0→1，初始优先优化分类任务，后期增强域对抗）。

**3. 约束条件**
- **共性约束**：特征物理含义一致性，要求目标域时域（峰值、RMS等）、频域（故障频率幅值）、时频（小波包能量占比）特征的计算方法与源域完全相同，确保特征对故障信息的编码方式一致；
- **差异约束**：域分布偏移最小化，通过域对抗机制实现——域分类器最小化域分类损失（准确区分源/目标域特征），特征提取器通过GRL反转梯度最大化域分类损失（让域分类器无法区分域归属），强制学习域不变特征。

#### 四、数学模型设计
模型基于领域对抗神经网络（DANN）构建，核心是“双任务协同优化”：通过标签分类任务保留故障诊断能力，通过域对抗任务减少域分布差异。

**1. 模型假设**
- **故障物理机制一致**：源域与目标域轴承类型相同（SKF6205/SKF6203），故障产生的物理机制（如故障频率计算、振动调制）一致，确保迁移学习的物理基础；
- **特征提取一致**：目标域特征提取流程与源域严格相同，保证特征维度与物理含义匹配，为域不变特征学习提供前提；
- **差异来源明确**：分布偏移主要来自转速差异导致的频域特征变化，其他干扰（如噪声）可忽略，模型只需聚焦于消除转速相关差异；
- **无监督域适应**：目标域无标签，需通过无监督迁移学习（UDA）利用源域标签信息。

**2. 核心机制**
- **特征提取器（G）**：输入13维特征，输出64维域不变特征，目标是“让标签分类器准确分类（利用源域标签），同时让域分类器无法区分域归属（减少分布差异）”；
- **标签分类器（C）**：输入域不变特征，输出4类故障概率，通过多分类交叉熵损失（分类损失）监督G学习对故障判别有用的特征；
- **域分类器（D）**：输入域不变特征（经GRL），输出域归属概率，通过二分类交叉熵损失（域分类损失）监督自身区分域归属，同时为G提供对抗目标；
- **总损失**：分类损失+域分类损失，通过反向传播分别优化各组件——C仅优化分类损失（保留诊断能力），D仅优化域分类损失（增强域区分能力），G同时优化分类损失（正向梯度）与反转的域分类损失（负向梯度，通过λ调节对抗强度）。

#### 五、求解算法与步骤
模型求解遵循“数据准备→特征提取→模型训练→分类预测→效果可视化”的流程，核心是DANN的联合训练与域适应。

**1. 数据准备与特征提取**
- **源域数据加载**：读取源域特征矩阵（161×13）及标签（161×1），计算各特征维度的均值与标准差（用于目标域标准化）；
- **目标域特征提取**：
  - **时域特征**：对每个目标域样本的振动信号计算峰值、RMS、峰值因子、脉冲因子、峭度（与源域公式一致）；
  - **频域特征**：根据转速与几何参数计算理论故障频率（BPFO/BPFI/BSF），对振动信号做FFT，提取理论频率±5%范围内的最大幅值；
  - **时频特征**：用db4小波对振动信号做2层分解，计算4个节点的能量占比；
  - **标准化**：用源域特征的均值与标准差对目标域特征标准化，消除尺度差异。

**2. DANN模型构建与训练**
- **网络搭建**：按结构参数定义G、C、D及GRL层，G的输出同时连接C（分类任务）与GRL→D（域对抗任务）；
- **联合训练**：
  - **前向传播**：源域样本经G→C输出分类概率，经G→GRL→D输出源域概率；目标域样本经G→GRL→D输出源域概率；
  - **损失计算**：分类损失（源域分类概率与标签的交叉熵）、域分类损失（源域/目标域概率与域标签的交叉熵），总损失=分类损失+域分类损失；
  - **反向传播**：C的梯度仅来自分类损失（保留分类能力），D的梯度仅来自域分类损失（增强域区分），G的梯度=分类损失梯度-λ×域分类损失梯度（通过GRL反转域损失梯度，驱动G学习域不变特征）；
  - **参数更新**：Adam优化器迭代100次，每轮更新λ=当前迭代次数/总迭代次数（渐进增强域对抗）。

**3. 目标域分类与迁移效果可视化**
- **分类预测**：训练完成后，目标域特征经G→C输出4类概率，取最大概率对应的类别作为预测标签；
- **效果可视化**：
  - **损失曲线**：绘制分类损失与域分类损失随迭代的变化，验证模型优化趋势（分类损失下降说明分类能力保留，域分类损失先降后升说明域对抗生效）；
  - **特征分布可视化**：对源域与目标域的域不变特征做PCA降维，绘制散点图，若迁移后两类特征分布从分散趋于重叠，说明域不变特征学习成功；
  - **分类置信度分布**：统计目标域样本预测概率的最大值（置信度），若多数样本置信度>0.8，说明预测可靠。

#### 六、预期结果
通过上述流程，模型将输出目标域16个样本的故障标签（0-3四类），并通过可视化结果验证迁移效果：
- **分类准确性**：利用DANN的域不变特征学习，目标域样本的分类错误率将显著低于直接使用源域模型（未迁移时因转速差异导致频域特征偏移，分类效果差）；
- **迁移有效性**：PCA散点图显示源域与目标域特征分布重叠度提升，损失曲线显示分类损失与域分类损失协同优化，证明模型成功捕捉共性故障特征并减少分布差异；
- **结果可靠性**：预测置信度多数>0.8，说明模型对目标域样本的分类决策具有较高确定性。

最终，目标域16个样本的预测标签将为实际工程中不同转速下的轴承故障诊断提供有效参考。
