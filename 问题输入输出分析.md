### 问题一的输入内容

#### 1. 数据文件
- **源域数据集文件**：题目给出的161个源域数据集文件，涵盖表1中轴承类型及典型故障场景，示例如下：`SKF6205_DE_1797rpm_0.007inch.mat`（SKF6205轴承，驱动端(DE)，转速1797rpm，故障直径0.007英寸）、`SKF6205_DE_1797rpm_0.014inch.mat`（SKF6205，DE，1797rpm，故障直径0.014英寸）、`SKF6203_FE_1498rpm_0.007inch.mat`（SKF6203轴承，风扇端(FE)，转速1498rpm，故障直径0.007英寸）、`SKF6205_Healthy_1797rpm.mat`（SKF6205轴承，正常状态，1797rpm）等，共161个。每个文件的字段名称及含义：`time`（时域时间序列，单位：秒，维度为1×N，N为采样点数）；`acceleration`（时域振动加速度信号，单位：g，维度为1×N）；`bearing_type`（轴承类型，字符串，取值为"SKF6205"或"SKF6203"）；`fault_type`（故障类型，字符串，取值为"Healthy"（正常）、"Outer_Race"（外圈故障）、"Inner_Race"（内圈故障）、"Ball"（滚动体故障））；`fault_diameter`（故障点直径，单位：英寸，取值为0.007、0.014或0.021）；`rpm`（轴承转速，单位：转/分钟，取值为1000至3000之间的整数）。
- **表格数据文件**：表1（`bearing_geometry_params.csv`），字段包括`bearing_type`（轴承类型，字符串，取值为"SKF6205"或"SKF6203"）、`n`（滚动体数，整数，SKF6205时为9，SKF6203时为9）、`d`（滚动体直径，单位：英寸，SKF6205时为0.3126，SKF6203时为0.2656）、`D`（轴承节径，单位：英寸，SKF6205时为1.537，SKF6203时为1.122）；表2（`fault_frequency_formula.csv`），字段包括`fault_name`（故障名称，字符串，取值为"Outer_Race"（外圈故障）、"Inner_Race"（内圈故障）、"Ball"（滚动体故障））、`frequency_formula`（特征频率公式，字符串，外圈故障为"f_r*(N_d/2)*(1-d/D)"，内圈故障为"f_r*(N_d/2)*(1+d/D)"，滚动体故障为"f_r*(D/d)*(1-(d/D)^2)"）。

#### 2. 变量定义
- **源域数据集**：记为\( \mathcal{S} = \{s_1, s_2, ..., s_{161}\} \)，其中每个样本\( s_i \)包含以下属性：
  - \( t_i \)：时域时间序列，\( t_i \in [0, 4] \)（采样时长\( T=4 \)秒）；
  - \( a_i(t) \)：时域振动加速度信号，\( a_i(t) \in \mathbb{R} \)（对应字段`acceleration`）；
  - \( bt_i \)：轴承类型，\( bt_i \in \{\text{SKF6205}, \text{SKF6203}\} \)（对应字段`bearing_type`）；
  - \( ft_i \)：故障类型，\( ft_i \in \{\text{Healthy}, \text{Outer_Race}, \text{Inner_Race}, \text{Ball}\} \)（对应字段`fault_type`）；
  - \( rpm_i \)：轴承转速，单位：转/分钟（对应字段`rpm`）；
  - \( f_{r,i} \)：轴承转速，单位：Hz，由`rpm_i`转换得到：\( f_{r,i} = \frac{\text{rpm}_i}{60} \)；
  - \( n_i \)：滚动体数，由\( bt_i \)从表1查询得到：若\( bt_i=\text{SKF6205} \)则\( n_i=9 \)，若\( bt_i=\text{SKF6203} \)则\( n_i=9 \)；
  - \( d_i \)：滚动体直径，单位：英寸，由\( bt_i \)从表1查询得到：若\( bt_i=\text{SKF6205} \)则\( d_i=0.3126 \)，若\( bt_i=\text{SKF6203} \)则\( d_i=0.2656 \)；
  - \( D_i \)：轴承节径，单位：英寸，由\( bt_i \)从表1查询得到：若\( bt_i=\text{SKF6205} \)则\( D_i=1.537 \)，若\( bt_i=\text{SKF6203} \)则\( D_i=1.122 \)；
  - \( fd_i \)：故障点直径，单位：英寸（对应字段`fault_diameter`）。

#### 3. 参数设置
- **源域数据筛选条件**：
  1. 轴承类型匹配：仅保留\( bt_i \in \{\text{SKF6205}, \text{SKF6203}\} \)的样本；
  2. 故障类型覆盖：保留\( ft_i \in \{\text{Healthy}, \text{Outer_Race}, \text{Inner_Race}, \text{Ball}\} \)的样本；
  3. 转速范围：保留\( \text{rpm}_i \in [1000, 3000] \)的样本；
  4. 故障直径范围：保留\( fd_i \in \{0.007, 0.014, 0.021\} \)英寸的样本。

- **特征分析方法参数**：
  - 时域特征计算窗口：取完整采样时长\( T=4 \)秒；
  - FFT参数：采样频率\( F_s=12000 \)Hz，采样点数\( N=48000 \)（由\( T=4 \)秒和\( F_s=12000 \)Hz计算得到：\( N=F_s \times T=12000 \times 4=48000 \)），频率分辨率\( \Delta f = \frac{F_s}{N} = \frac{12000}{48000}=0.25 \)Hz；
  - 小波变换参数：选用Daubechies4（db4）小波基，分解层数3层。

#### 4. 约束条件
- **轴承几何参数约束**：滚动体数\( n_i \)、滚动体直径\( d_i \)、轴承节径\( D_i \)必须严格匹配表1中对应轴承类型的参数，即：\[
  \begin{cases}
  n_i=9, d_i=0.3126, D_i=1.537 & (bt_i=\text{SKF6205}) \\
  n_i=9, d_i=0.2656, D_i=1.122 & (bt_i=\text{SKF6203})
  \end{cases}
  \]
- **故障特征频率约束**：需基于表2公式计算理论特征频率，用于频域特征验证：
  - 外圈故障特征频率：\( \text{BPFO}*i = f*{r,i} \cdot \frac{n_i}{2} \cdot \left(1 - \frac{d_i}{D_i}\right) \)；
  - 内圈故障特征频率：\( \text{BPFI}*i = f*{r,i} \cdot \frac{n_i}{2} \cdot \left(1 + \frac{d_i}{D_i}\right) \)；
  - 滚动体故障特征频率：\( \text{BSF}*i = f*{r,i} \cdot \frac{D_i}{d_i} \left[ 1 - \left( \frac{d_i}{D_i} \right)^2 \right] \)；
- **特征提取约束**：
  - 时域特征需基于完整时间序列计算，约束式为：时域特征\( F_t \)满足\( F_t = F(a_i(t)) \)，其中\( a_i(t) \)是完整的4秒时间序列；
  - 频域特征需对应理论特征频率的±1Hz范围内的最大幅值，约束式为：频域特征\( F_f = \max\{ |A_i(f)| \mid f \in [\text{FF}_i - 1, \text{FF}_i + 1] \} \)，其中\( \text{FF}_i \)是理论特征频率（\( \text{BPFO}_i \)、\( \text{BPFI}_i \)或\( \text{BSF}_i \)），\( A_i(f) \)是\( a_i(t) \)的FFT结果；
  - 时频特征需计算小波包分解后各节点的能量占比，约束式为：时频特征\( F_w = \left( \frac{E_1}{E_{\text{total}}}, \frac{E_2}{E_{\text{total}}}, ..., \frac{E_k}{E_{\text{total}}} \right) \)，其中\( E_j \)是小波包分解第j个节点的能量，\( E_{\text{total}} = \sum_{j=1}^k E_j \)，且\( \sum_{j=1}^k \frac{E_j}{E_{\text{total}}} = 1 \)。

### 问题一的输出内容
1. **筛选后的源域数据集**：包含所有满足筛选条件的161个样本，每个样本保留字段：`time`、`acceleration`、`bearing_type`、`fault_type`、`rpm`、`fault_diameter`，并补充计算后的`f_r`（转速，Hz）、`n`（滚动体数）、`d`（滚动体直径）、`D`（轴承节径）。
2. **代表性源域数据的特征分析结果**：
   - 时域特征对比：不同故障类型的峰值（\( \text{Peak} = \max|a_i(t)| \)）、均方根值（\( \text{RMS} = \sqrt{\frac{1}{4}\int_0^4 a_i(t)^2 dt} \)）、峰值因子（\( \text{CrestFactor} = \frac{\text{Peak}}{\text{RMS}} \)）、脉冲因子（\( \text{ImpulseFactor} = \frac{\text{Peak}}{\frac{1}{4}\int_0^4 |a_i(t)| dt} \)）、峭度（\( \text{Kurtosis} = \frac{1}{N}\sum_{i=1}^N \left( \frac{x_i - \mu}{\sigma} \right)^4 - 3 \)，其中\( \mu \)为均值，\( \sigma \)为标准差）的统计分布；
   - 频域特征对比：不同故障类型在理论特征频率（\( \text{BPFO} \)、\( \text{BPFI} \)、\( \text{BSF} \)）处的幅值（\( |A_i(f)| \)）分布；
   - 时频特征对比：不同故障类型的小波包时频图。
3. **整体数据集的特征矩阵**：每个样本对应一个13维特征向量，包含：
   - 时域特征：峰值、均方根值、峰值因子、脉冲因子、峭度；
   - 频域特征：\( \text{BPFO} \)幅值、\( \text{BPFI} \)幅值、\( \text{BSF} \)幅值、特征频率谐波总能量（\( \sum_{k=1}^3 |A_i(k \cdot \text{FF}_i)| \)，其中\( k \)是谐波次数）；
   - 时频特征：小波包分解3层后4个节点的能量占比。
4. **特征选择结果**：通过相关性分析或ReliefF算法筛选出的有效特征子集，用于后续诊断任务。

### 问题二的输入内容

#### 1. 数据文件
- **源域特征数据集文件**：问题一输出的`Source_Features.csv`，由161个源域原始数据文件经特征提取得到，字段定义如下：
  - `SampleID`：样本唯一标识（整数，1~161）；
  - `Peak`：时域峰值（振动信号的最大加速度值，单位：g）；
  - `RMS`：时域均方根值（振动信号的能量指标，公式：\( \text{RMS} = \sqrt{\frac{1}{N}\sum_{i=1}^N x_i^2} \)，其中\( x_i \)为加速度样本值）；
  - `CrestFactor`：时域峰值因子（峰值与均方根的比值，公式：\( \text{CrestFactor} = \frac{\text{Peak}}{\text{RMS}} \)）；
  - `ImpulseFactor`：时域脉冲因子（峰值与绝对均值的比值，公式：\( \text{ImpulseFactor} = \frac{\text{Peak}}{\frac{1}{N}\sum_{i=1}^N |x_i|} \)）；
  - `Kurtosis`：时域峭度（信号分布的陡峭程度，公式：\( \text{Kurtosis} = \frac{1}{N}\sum_{i=1}^N \left( \frac{x_i - \mu}{\sigma} \right)^4 - 3 \)，其中\( \mu \)为均值，\( \sigma \)为标准差）；
  - `Amp_BPFO`：频域外圈故障特征频率（BPFO）对应的幅值（单位：g²/Hz）；
  - `Amp_BPFI`：频域内圈故障特征频率（BPFI）对应的幅值（单位：g²/Hz）；
  - `Amp_BSF`：频域滚动体故障特征频率（BSF）对应的幅值（单位：g²/Hz）；
  - `Energy_WP1`：时频域小波包分解后第1个节点的能量占比（无单位）；
  - `Energy_WP2`：时频域小波包分解后第2个节点的能量占比（无单位）；
  - `Energy_WP3`：时频域小波包分解后第3个节点的能量占比（无单位）；
  - `Energy_WP4`：时频域小波包分解后第4个节点的能量占比（无单位）；
  - `Label`：故障类型标签（整数，0=正常，1=内圈故障，2=外圈故障，3=滚动体故障）。

#### 2. 变量定义
- \( X \)：源域特征矩阵（维度：161×13），每行对应一个样本的13维特征向量（`Peak`~`Energy_WP4`）；
- \( y \)：源域标签向量（维度：161×1），元素为`Label`字段值；
- \( X_{\text{train}} \)：训练集特征矩阵（维度：\( N_{\text{train}} \)×13），\( N_{\text{train}} \)为训练集样本数；
- \( y_{\text{train}} \)：训练集标签向量（维度：\( N_{\text{train}} \)×1）；
- \( X_{\text{test}} \)：测试集特征矩阵（维度：\( N_{\text{test}} \)×13），\( N_{\text{test}} = 161 - N_{\text{train}} \)；
- \( y_{\text{test}} \)：测试集标签向量（维度：\( N_{\text{test}} \)×1）；
- \( M \)：源域故障诊断模型；
- \( \text{Metrics} \)：模型评价指标集合，包括准确率、精确率、召回率、F1-score、混淆矩阵。

#### 3. 参数设置
- **数据划分参数**：
  - 训练集占比70%，计算得\( N_{\text{train}} = \text{round}(161 \times 0.7) = 113 \)；
  - 测试集占比30%，计算得\( N_{\text{test}} = 161 - 113 = 48 \)；
  - 采用分层抽样，约束式为：对每个故障类型\( k \)（\( k=0,1,2,3 \)），训练集样本数\( N_{\text{train},k} = \text{round}(N_k \times 0.7) \)，测试集样本数\( N_{\text{test},k} = N_k - N_{\text{train},k} \)，其中\( N_k \)为源域中类型\( k \)的总样本数；
  - 随机种子`random_state=42`。
- **特征归一化参数**：使用`StandardScaler`将特征标准化为均值0、方差1，公式：\( x_{\text{scaled}} = \frac{x - \mu_f}{\sigma_f} \)，其中\( \mu_f = \frac{1}{161}\sum_{i=1}^{161} x_{i,f} \)（特征\( f \)的均值），\( \sigma_f = \sqrt{\frac{1}{161}\sum_{i=1}^{161} (x_{i,f} - \mu_f)^2} \)（特征\( f \)的标准差）。
- **模型超参数**（以随机森林为例）：
  - 决策树数量`n_estimators=100`；
  - 决策树最大深度`max_depth=5`；
  - 节点分裂最小样本数`min_samples_split=2`；
  - 叶子节点最小样本数`min_samples_leaf=1`；
  - 随机种子`random_state=42`。
- **评价参数**：
  - 准确率：\( \text{Accuracy} = \frac{TP + TN}{TP + TN + FP + FN} \)，其中\( TP \)是真阳性数，\( TN \)是真阴性数，\( FP \)是假阳性数，\( FN \)是假阴性数；
  - 精确率（分类型）：\( \text{Precision}*k = \frac{TP_k}{\sum*{j=0}^3 (TP_j + FP_j)} \)，其中\( TP_k \)是类型\( k \)的真阳性数；
  - 召回率（分类型）：\( \text{Recall}_k = \frac{TP_k}{TP_k + FN_k} \)，其中\( FN_k \)是类型\( k \)的假阴性数；
  - F1-score（分类型）：\( \text{F1}_k = 2 \cdot \frac{\text{Precision}_k \cdot \text{Recall}_k}{\text{Precision}_k + \text{Recall}_k} \)；
  - 混淆矩阵：\( \text{CM}_{k,j} \)表示真实类型\( k \)预测为类型\( j \)的样本数。

#### 4. 约束条件
- **分层抽样约束**：对每个故障类型\( k \)（\( k=0,1,2,3 \)），\( N_{\text{train},k} = \text{round}(N_k \times 0.7) \)且\( N_{\text{test},k} = N_k - N_{\text{train},k} \)；
- **特征归一化约束**：所有特征必须经过标准化处理，约束式为：对每个特征\( f \)，\( \mu_{\text{scaled},f} = 0 \)且\( \sigma_{\text{scaled},f} = 1 \)；
- **模型可重复性约束**：所有涉及随机过程的参数必须设置固定随机种子`random_state=42`；
- **故障类型平衡约束**：源域中每个故障类型的样本数\( N_k \geq 10 \)。

### 问题二的输出内容
1. **数据划分结果**：训练集与测试集的样本数量，及各故障类型在训练集、测试集中的分布。
2. **训练好的诊断模型**：模型的结构与超参数。
3. **模型评价结果**：测试集上的准确率、分类型精确率/召回率/F1-score，及混淆矩阵。
4. **性能可视化结果**：特征重要性排序图、模型训练曲线。

### 问题三的输入内容

#### 1. 数据文件
- **源域特征数据集文件**：问题一输出的`Source_Features.csv`，字段定义如下：
  - `SampleID`：样本唯一标识（整数，1~161）；
  - `Peak`：时域峰值（振动信号的最大加速度值，单位：g）；
  - `RMS`：时域均方根值（振动信号的能量指标，公式：\( \text{RMS} = \sqrt{\frac{1}{N}\sum_{i=1}^N x_i^2} \)）；
  - `CrestFactor`：时域峰值因子（峰值与均方根的比值，公式：\( \text{CrestFactor} = \frac{\text{Peak}}{\text{RMS}} \)）；
  - `ImpulseFactor`：时域脉冲因子（峰值与绝对均值的比值，公式：\( \text{ImpulseFactor} = \frac{\text{Peak}}{\frac{1}{N}\sum_{i=1}^N |x_i|} \)）；
  - `Kurtosis`：时域峭度（信号分布的陡峭程度，公式：\( \text{Kurtosis} = \frac{1}{N}\sum_{i=1}^N \left( \frac{x_i - \mu}{\sigma} \right)^4 - 3 \)）；
  - `Amp_BPFO`：频域外圈故障特征频率（BPFO）对应的幅值（单位：g²/Hz）；
  - `Amp_BPFI`：频域内圈故障特征频率（BPFI）对应的幅值（单位：g²/Hz）；
  - `Amp_BSF`：频域滚动体故障特征频率（BSF）对应的幅值（单位：g²/Hz）；
  - `Energy_WP1`~`Energy_WP4`：时频域小波包分解后4个节点的能量占比（无单位）；
  - `Label`：故障类型标签（整数，0=正常，1=内圈故障，2=外圈故障，3=滚动体故障）。
- **目标域数据集文件**：题目给出的16个目标域数据集文件，示例如下：`Train_Bearing_DE_2500rpm_Unknown.mat`（实际运营列车轴承，驱动端(DE)，转速2500rpm，故障状态未知）、`Train_Bearing_FE_2000rpm_Unknown.mat`（实际运营列车轴承，风扇端(FE)，转速2000rpm，故障状态未知）等，共16个。每个文件的字段名称及含义：
  - `time`：时域时间序列（单位：秒，维度为1×N）；
  - `acceleration`：时域振动加速度信号（单位：g，维度为1×N）；
  - `bearing_type`：轴承类型（字符串，取值为"SKF6205"或"SKF6203"）；
  - `rpm`：轴承转速（单位：转/分钟，如2500）。
- **表格数据文件**：表1（`bearing_geometry_params.csv`），字段包括`bearing_type`（轴承类型，字符串，取值为"SKF6205"或"SKF6203"）、`n`（滚动体数，整数，SKF6205时为9，SKF6203时为9）、`d`（滚动体直径，单位：英寸，SKF6205时为0.3126，SKF6203时为0.2656）、`D`（轴承节径，单位：英寸，SKF6205时为1.537，SKF6203时为1.122）；表2（`fault_frequency_formula.csv`），字段包括`fault_name`（故障名称，字符串，取值为"Outer_Race"（外圈故障）、"Inner_Race"（内圈故障）、"Ball"（滚动体故障））、`frequency_formula`（特征频率公式，字符串，外圈故障为"f_r*(N_d/2)*(1-d/D)"，内圈故障为"f_r*(N_d/2)*(1+d/D)"，滚动体故障为"f_r*(D/d)*(1-(d/D)^2)"）。

#### 2. 变量定义
- **源域特征数据集**：问题一输出的`Source_Features.csv`对应的特征矩阵\( X_s \)（维度：161×13）和标签向量\( y_s \)（维度：161×1）；
- **目标域数据集**：记为\( \mathcal{T} = \{t_1, t_2, ..., t_{16}\} \)，每个样本\( t_j \)包含以下属性：
  - \( t_j^{\text{time}} \)：时域时间序列，\( t_j^{\text{time}} \in [0, 4] \)（采样时长\( T=4 \)秒）；
  - \( t_j^{\text{acc}} \)：时域振动加速度信号，\( t_j^{\text{acc}} \in \mathbb{R} \)（对应字段`acceleration`）；
  - \( t_j^{\text{bt}} \)：轴承类型，\( t_j^{\text{bt}} \in \{\text{SKF6205}, \text{SKF6203}\} \)（对应字段`bearing_type`）；
  - \( t_j^{\text{rpm}} \)：轴承转速，单位：转/分钟（对应字段`rpm`）；
  - \( t_j^{\text{fr}} \)：轴承转速，单位：Hz，由`rpm`转换得到：\( t_j^{\text{fr}} = \frac{t_j^{\text{rpm}}}{60} \)；
  - \( t_j^{\text{n}} \)：滚动体数，由\( t_j^{\text{bt}} \)从表1查询得到：若\( t_j^{\text{bt}}=\text{SKF6205} \)则\( t_j^{\text{n}}=9 \)，若\( t_j^{\text{bt}}=\text{SKF6203} \)则\( t_j^{\text{n}}=9 \)；
  - \( t_j^{\text{d}} \)：滚动体直径，单位：英寸，由\( t_j^{\text{bt}} \)从表1查询得到：若\( t_j^{\text{bt}}=\text{SKF6205} \)则\( t_j^{\text{d}}=0.3126 \)，若\( t_j^{\text{bt}}=\text{SKF6203} \)则\( t_j^{\text{d}}=0.2656 \)；
  - \( t_j^{\text{D}} \)：轴承节径，单位：英寸，由\( t_j^{\text{bt}} \)从表1查询得到：若\( t_j^{\text{bt}}=\text{SKF6205} \)则\( t_j^{\text{D}}=1.537 \)，若\( t_j^{\text{bt}}=\text{SKF6203} \)则\( t_j^{\text{D}}=1.122 \)；
- **目标域特征矩阵**：\( X_t \)（维度：16×13），由目标域数据集经问题一的特征提取方法得到，每个样本对应一个13维特征向量，包含时域特征（峰值、均方根值、峰值因子、脉冲因子、峭度）、频域特征（\( \text{BPFO} \)幅值、\( \text{BPFI} \)幅值、\( \text{BSF} \)幅值、特征频率谐波总能量）、时频特征（小波包分解3层后4个节点的能量占比）；
- \( M_{\text{source}} \)：问题二训练好的源域故障诊断模型；
- \( M_{\text{target}} \)：目标域故障诊断模型；
- \( y_t \)：目标域数据的预测标签向量（维度：16×1）。

#### 3. 参数设置
- **迁移学习方法**：选用领域自适应中的Domain-Adversarial Neural Networks（DANN）；
- **模型结构参数**：
  - 特征提取器\( G \)：输入为13维特征，输出为64维特征，结构为“全连接层1（13→64，ReLU激活）→全连接层2（64→64，ReLU激活）”；
  - 标签分类器\( C \)：输入为64维特征，输出为4类概率，结构为“全连接层（64→4，Softmax激活）”；
  - 域分类器\( D \)：输入为64维特征，输出为域标签（源域/目标域）概率，结构为“全连接层1（64→32，ReLU激活）→全连接层2（32→1，Sigmoid激活）”；
- **超参数**：
  - 学习率\( lr=0.001 \)；
  - 迭代次数\( epochs=100 \)；
  - 批次大小\( batch_size=32 \)；
  - 域分类器的梯度反转系数\( \lambda \)：随迭代增加线性递增，公式为\( \lambda = \frac{epochs_{\text{current}}}{epochs} \)，其中\( epochs_{\text{current}} \)是当前迭代次数；
  - 随机种子`random_state=42`；
- **特征归一化参数**：使用问题二的`StandardScaler`对目标域特征进行标准化，公式：\( x_{t,\text{scaled}} = \frac{x_t - \mu_f}{\sigma_f} \)，其中\( \mu_f \)和\( \sigma_f \)是问题二中源域特征的均值和标准差；
- **故障特征频率参数**：基于表2公式计算目标域理论特征频率，公式同问题一：
  - 外圈故障特征频率：\( \text{BPFO}_j = t_j^{\text{fr}} \cdot \frac{t_j^{\text{n}}}{2} \cdot \left(1 - \frac{t_j^{\text{d}}}{t_j^{\text{D}}} \right) \)；
  - 内圈故障特征频率：\( \text{BPFI}_j = t_j^{\text{fr}} \cdot \frac{t_j^{\text{n}}}{2} \cdot \left(1 + \frac{t_j^{\text{d}}}{t_j^{\text{D}}} \right) \)；
  - 滚动体故障特征频率：\( \text{BSF}_j = t_j^{\text{fr}} \cdot \frac{t_j^{\text{D}}}{t_j^{\text{d}}} \left[ 1 - \left( \frac{t_j^{\text{d}}}{t_j^{\text{D}}} \right)^2 \right] \)。

#### 4. 约束条件
- **源域与目标域共性约束**：
  - 轴承类型一致：\( t_j^{\text{bt}} \in \{\text{SKF6205}, \text{SKF6203}\} \)，与源域相同；
  - 特征维度一致：目标域特征矩阵\( X_t \)的维度为16×13，与源域特征矩阵\( X_s \)的维度（161×13）一致；
- **迁移过程约束**：
  - 标签分类器损失约束：源域标签预测损失\( L_{\text{cls}} = -\frac{1}{161}\sum_{i=1}^{161} \sum_{k=0}^3 y_{s,i,k} \log C(G(x_{s,i}))*k \)，其中\( y*{s,i,k} \)是源域样本\( i \)的独热编码标签，\( C(G(x_{s,i}))*k \)是标签分类器对特征\( G(x*{s,i}) \)的第\( k \)类预测概率；
  - 域分类器损失约束：域标签预测损失\( L_{\text{dom}} = -\frac{1}{161 + 16} \left( \sum_{i=1}^{161} \log D(G(x_{s,i})) + \sum_{j=1}^{16} \log(1 - D(G(x_{t,j}))) \right) \)，其中\( D(G(x)) \)是域分类器对特征\( G(x) \)的源域概率预测；
  - 总损失约束：\( L_{\text{total}} = L_{\text{cls}} + L_{\text{dom}} \)；
  - 特征提取器的梯度约束：\(
    abla_G L_{\text{total}} =
    abla_G L_{\text{cls}} - \lambda
    abla_G L_{\text{dom}} \)；
- **特征归一化约束**：目标域特征需使用源域的均值和标准差进行标准化，约束式为：\( \mu_{t,f} = \mu_{s,f} \)且\( \sigma_{t,f} = \sigma_{s,f} \)，其中\( \mu_{s,f} \)和\( \sigma_{s,f} \)是源域特征\( f \)的均值和标准差，\( \mu_{t,f} \)和\( \sigma_{t,f} \)是目标域特征\( f \)的均值和标准差。

### 问题三的输出内容
1. **目标域特征矩阵**：每个目标域样本对应一个13维特征向量，包含时域特征、频域特征、时频特征。
2. **训练好的目标域诊断模型**：模型的结构与超参数，包括特征提取器\( G \)、标签分类器\( C \)、域分类器\( D \)。
3. **目标域数据的分类结果**：目标域16个样本的预测标签向量\( y_t \)。
4. **迁移结果的可视化展示**：域对抗损失曲线（训练过程中\( L_{\text{dom}} \)的变化）、源域与目标域特征对齐散点图（特征提取器输出的2维投影）、目标域样本的故障类型分布直方图。
5. **迁移结果的分析**：源域与目标域的域差异减小情况、目标域各故障类型的预测置信度分布。

### 问题四的输入内容

#### 1. 数据文件与变量
- **源域特征数据集文件**：问题一输出的`Source_Features.csv`，字段定义同问题三；
- **目标域特征数据集文件**：问题三输出的目标域特征矩阵\( X_t \)（维度：16×13）；
- **模型结构变量**：问题三的DANN模型结构，包括特征提取器\( G \)、标签分类器\( C \)、域分类器\( D \)；
- **迁移过程变量**：问题三的迁移过程，包括损失函数（\( L_{\text{cls}} \)、\( L_{\text{dom}} \)、\( L_{\text{total}} \)）、梯度计算（\(
  abla_G L_{\text{total}} \)）；
- **决策过程变量**：问题三的决策过程，即使用标签分类器\( C \)对目标域特征\( G(x_{t,j}) \)进行预测，得到标签\( y_{t,j} = \arg\max_k C(G(x_{t,j}))_k \)；
- **轴承故障机理变量**：表1的轴承几何参数（\( n \)、\( d \)、\( D \)）、表2的故障特征频率公式（\( \text{BPFO} \)、\( \text{BPFI} \)、\( \text{BSF} \)）、图1-图5的故障信号特征（内圈故障的高幅值、外圈故障的BPFO频域特征等）。

#### 2. 参数设置
- **可解释性分析维度**：事前解释（模型结构设计的合理性）、迁移过程解释（域对抗训练的作用）、事后解释（目标域决策的特征重要性）；
- **分析方法**：
  - 事前解释：结合轴承故障机理，分析模型结构设计为何能提取有效特征（如特征提取器的全连接层提取时域、频域、时频特征的融合特征）；
  - 迁移过程解释：通过域对抗损失的变化，分析特征提取器如何学习域不变特征；
  - 事后解释：通过SHAP值或LIME算法，分析目标域样本决策中各特征的重要性。

#### 3. 约束条件
- **机理一致性约束**：解释需结合轴承故障机理，约束式为：解释内容\( E \)满足\( E \leftrightarrow M(f_m) \)，其中\( f_m \)是轴承故障机理（如内圈故障的BPFI特征重要性）；
- **模型对应约束**：解释需对应模型的具体部分，约束式为：解释内容\( E \)对应模型的组件\( C_m \)（如特征提取器的全连接层对应频域特征提取）；
- **可理解性约束**：解释需使用诊断人员可理解的术语（如“内圈故障的高RMS值”而非“特征维度1的高值”）。

### 问题四的输出内容
1. **事前可解释性分析结果**：模型结构设计的合理性分析，包括特征提取器为何能提取轴承故障特征、标签分类器为何能区分故障类型、域分类器为何能区分源域与目标域。
2. **迁移过程可解释性分析结果**：域对抗训练的作用分析，包括特征提取器如何学习域不变特征、域分类器与特征提取器的对抗过程如何减小域差异。
3. **事后可解释性分析结果**：目标域决策的特征重要性分析，包括各故障类型的关键特征（如内圈故障的`Amp_BPFI`特征重要性最高）、目标域样本决策的特征贡献（如某个目标域样本被预测为内圈故障是因为其`RMS`值高且`Amp_BPFI`幅值大）。
4. **可解释性可视化结果**：特征提取器的神经元激活图（展示哪些神经元对应故障特征）、域对抗损失的变化曲线（展示迁移过程中域差异的减小）、目标域样本的SHAP值 Summary Plot（展示特征重要性分布）。
