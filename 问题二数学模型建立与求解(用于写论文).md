### 问题二数学模型建立与求解内容

#### 一、问题二的要求
问题二针对旋转机械（如轴承）的源域故障诊断任务，核心目标是**解决“全局特征无法捕捉局部故障信息”的局限性**：通过**EMD时频局部化分解**提取振动信号中的故障冲击特征，结合**CNN关联学习**捕捉IMF特征间的交互关系，最终提升源域故障诊断的准确性。输入为包含161个样本的原始振动信号数据集`Source_Vibration_Signals.csv`，输出为样本的故障类型概率分布及诊断性能指标（准确率、精确率等）。

#### 二、问题二的完整数学模型建立
本部分通过**“假设→定义→约束→公式推导”**的逻辑链，构建严谨的数学模型，涵盖变量定义、参数设置、约束条件、模型假设及完整公式。

##### 1. 变量定义（精准描述“EMD-IMF特征-标签”映射）
- **原始振动信号矩阵**：\( \mathbf{S} = [\mathbf{s}*1, \mathbf{s}*2, \dots, \mathbf{s}*{161}]^\top \in \mathbb{R}^{161 \times N} \)，其中\( \mathbf{s}*i = [s*{i,1}, s*{i,2}, \dots, s_{i,N}]^\top \)为第\( i \)个样本的振动信号时间序列（\( N=1024 \)为采样点数量，单位：g）；
- **EMD-IMF分量集合**：对每个样本\( \mathbf{s}*i \)，EMD分解得到\( M=5 \)个**固有模态函数（IMF）** \( \mathbf{c}*{i,1}, \mathbf{c}*{i,2}, \dots, \mathbf{c}*{i,5} \in \mathbb{R}^N \)（时频局部化分量，反映故障冲击）和1个残余分量\( \mathbf{r}*{i,5} \in \mathbb{R}^N \)（单调趋势项），满足\( \mathbf{s}*i = \sum*{m=1}^5 \mathbf{c}*{i,m} + \mathbf{r}_{i,5} \)；
- **IMF时域特征向量**：对每个IMF分量\( \mathbf{c}*{i,m} \)，提取5维时域特征（冲击强度与能量分布），形成特征向量\( \mathbf{f}*{i,m} = [\text{Peak}*{i,m}, \text{RMS}*{i,m}, \text{CrestFactor}*{i,m}, \text{ImpulseFactor}*{i,m}, \text{Kurtosis}_{i,m}]^\top \in \mathbb{R}^5 \)；
- **源域特征矩阵**：\( \mathbf{X} = [\mathbf{x}*1, \mathbf{x}*2, \dots, \mathbf{x}*{161}]^\top \in \mathbb{R}^{161 \times 25} \)，其中\( \mathbf{x}*i = [\mathbf{f}*{i,1}^\top, \mathbf{f}*{i,2}^\top, \dots, \mathbf{f}_{i,5}^\top]^\top \)为第\( i \)个样本的EMD-IMF组合特征（5个IMF×5维特征=25维）；
- **源域标签向量**：\( \mathbf{y} = [y_1, y_2, \dots, y_{161}]^\top \in \mathbb{N}^{161 \times 1} \)，\( y_i \in \{0,1,2,3\} \)对应“正常、内圈故障、外圈故障、滚动体故障”；
- **训练集/测试集**：按70%-30%分层抽样得到\( \mathbf{X}*{\text{train}} \in \mathbb{R}^{113 \times 25} \)、\( \mathbf{y}*{\text{train}} \in \mathbb{N}^{113 \times 1} \)（训练集），\( \mathbf{X}*{\text{test}} \in \mathbb{R}^{48 \times 25} \)、\( \mathbf{y}*{\text{test}} \in \mathbb{N}^{48 \times 1} \)（测试集）；
- **EMD-CNN模型**：\( \mathcal{M}_{\text{EMD-CNN}} \)，输入为标准化后的25维EMD-IMF特征序列，输出为4类故障的概率分布\( \mathbf{p} = [p_0, p_1, p_2, p_3]^\top \)（\( p_k \)为样本属于第\( k \)类的概率）；
- **评价指标**：准确率（Accuracy）、精确率（Precision）、召回率（Recall）、F1-score、混淆矩阵（Confusion Matrix），量化诊断性能。

##### 2. 参数设置（贴合“EMD+CNN”核心逻辑）
- **EMD分解参数**：
  - IMF数量\( M=5 \)：故障冲击集中在5个以内IMF，残余分量分解至第5个IMF时呈单调（无波动），保证特征维度一致；
  - 筛选停止准则：IMF分量的**包络均值绝对值≤0.01g**（局部均值趋近于0）且**极值点数量与过零点数量差≤1**（满足IMF定义）。
- **IMF特征提取参数**：对每个IMF提取5维时域特征（故障冲击敏感）：
  - 峰值（Peak）：瞬时冲击强度；
  - 均方根（RMS）：平均能量水平；
  - 峰值因子（CrestFactor）：冲击性识别；
  - 脉冲因子（ImpulseFactor）：周期性冲击敏感；
  - 峭度（Kurtosis）：分布陡峭程度（故障时增大）。
- **数据划分参数**：
  - 训练集占比70%，测试集30%；
  - 分层抽样（保持类别分布一致），随机种子`random_state=42`（可重复）。
- **特征归一化参数**：使用`StandardScaler`将特征标准化为**均值0、方差1**，消除量纲差异（如Peak单位为g，CrestFactor无单位）。
- **EMD-CNN超参数**：
  - 输入层形状\( (25,1) \)：25维特征序列+1通道（单变量）；
  - 卷积层：1D卷积（核大小5，64通道，ReLU激活），捕捉相邻5个特征的关联；
  - 池化层：1D最大池化（窗口2），降维并保留局部最大值；
  - 全连接层：640→64→4（压缩特征+输出概率）；
  - 训练参数：Adam优化器（lr=0.001）、交叉熵损失、epochs=100、batch_size=32（保证收敛稳定性）。

##### 3. 模型假设（从问题需求提炼，带依据）
- **假设1**：旋转机械振动信号可分解为5个IMF与1个残余分量，且故障冲击集中在IMF中。依据：EMD的时频局部化特性，故障冲击对应高频IMF，5个IMF足以捕捉主要冲击（残余分量为单调趋势，无故障信息）。
- **假设2**：IMF的5维时域特征能有效区分故障类型。依据：故障会改变IMF的冲击强度、能量分布，这些特征对冲击敏感（如峰值因子在故障时显著增大）。
- **假设3**：训练集与测试集类别分布一致时，模型泛化性能更优。依据：分层抽样避免样本偏斜，保证模型学习到所有类别特征（如“正常”类样本不会被过度采样）。
- **假设4**：特征标准化后，CNN对所有特征权重公平。依据：不同特征量纲不同（如Peak是g，CrestFactor无单位），标准化后特征在同一尺度，CNN能公平学习。

##### 4. 约束条件（公式化表达，带解释）
- **约束1（EMD分解一致性）**：对任意样本\( i \)，EMD分解的IMF数量\( M_i=5 \)，即：\[ M_i = 5, \quad \forall i \in \{1,2,...,161\} \]解释：保证每个样本的特征维度一致（25维），便于CNN处理。
- **约束2（特征完整性）**：对任意样本\( i \)、IMF分量\( m \)，提取的特征向量\( \mathbf{f}*{i,m} \)维度为5，即：\[ \dim(\mathbf{f}*{i,m}) = 5, \quad \forall i,m \]解释：避免特征缺失，确保每个IMF的信息完整。
- **约束3（分层抽样分布一致）**：对任意故障类型\( k \)，训练集样本占比\( \frac{N_{\text{train},k}}{N_k} \approx 0.7 \)，即：\[ \frac{N_{\text{train},k}}{N_k} = \lfloor 0.7 \cdot N_k \rfloor / N_k, \quad \forall k \in \{0,1,2,3\} \]解释：保持训练集与测试集的类别分布一致，避免模型偏倚。
- **约束4（特征标准化）**：对任意特征维度\( f \)，标准化后的训练集特征均值\( \mu_f^{\text{scaled}}=0 \)、方差\( \sigma_f^{\text{scaled}}=1 \)，即：\[ \mu_f^{\text{scaled}} = 0, \quad \sigma_f^{\text{scaled}} = 1, \quad \forall f \in \{1,2,...,25\} \]解释：消除量纲差异，保证CNN权重公平。

##### 5. 完整数学模型公式（连贯推导，带详细解释）

###### （1）EMD分解模型（时频局部化）
**目标**：将原始振动信号分解为IMF分量（捕捉故障冲击）与残余分量（趋势项）。对第\( i \)个样本的振动信号\( \mathbf{s}_i(t) \)（\( t=1,2,...,1024 \)），EMD通过“筛选”过程得到IMF：
1. **拟合包络**：用三次样条插值拟合局部极大值点得到上包络\( u_i(t) \)，拟合局部极小值点得到下包络\( l_i(t) \)；
2. **计算中间信号**：包络均值\( m_i(t) = \frac{u_i(t) + l_i(t)}{2} \)，中间信号\( h_i(t) = \mathbf{s}_i(t) - m_i(t) \)；
3. **筛选停止**：重复步骤1-2，直到\( h_i(t) \)满足IMF条件（包络均值≤0.01g且极值点-过零点差≤1），此时\( h_i(t) \)为第一个IMF分量\( \mathbf{c}_{i,1}(t) \)；
4. **残余更新**：计算残余分量\( r_{i,1}(t) = \mathbf{s}*i(t) - \mathbf{c}*{i,1}(t) \)，将\( r_{i,1}(t) \)作为新输入重复筛选，最终得到5个IMF：\[ \mathbf{s}*i(t) = \sum*{m=1}^5 \mathbf{c}*{i,m}(t) + r*{i,5}(t) \]**解释**：IMF是时频局部化分量，故障冲击会集中在前几个IMF中（如滚动体故障的周期性冲击对应IMF2-IMF4），残余分量为单调趋势，无故障信息。

###### （2）IMF特征提取模型（故障信息量化）
**目标**：从每个IMF中提取能区分故障的时域特征，形成25维组合特征。对第\( i \)个样本的第\( m \)个IMF分量\( \mathbf{c}_{i,m}(t) \)，提取以下5维特征：
1. **峰值（Peak）**：瞬时冲击强度（故障时增大）：\[ \text{Peak}*{i,m} = \max*{t=1}^{1024} |\mathbf{c}_{i,m}(t)| \]
2. **均方根（RMS）**：平均能量水平（故障时能量分布改变）：\[ \text{RMS}*{i,m} = \sqrt{\frac{1}{1024} \sum*{t=1}^{1024} \mathbf{c}_{i,m}(t)^2} \]
3. **峰值因子（CrestFactor）**：冲击性识别（故障时Peak增大，RMS变化小，比值增大）：\[ \text{CrestFactor}*{i,m} = \frac{\text{Peak}*{i,m}}{\text{RMS}_{i,m}} \]
4. **脉冲因子（ImpulseFactor）**：周期性冲击敏感（如滚动体故障，Peak增大而绝对均值变化小）：\[ \text{ImpulseFactor}*{i,m} = \frac{\text{Peak}*{i,m}}{\frac{1}{1024} \sum_{t=1}^{1024} |\mathbf{c}_{i,m}(t)|} \]
5. **峭度（Kurtosis）**：分布陡峭程度（故障时冲击增多，分布更陡峭，值增大）：\[ \text{Kurtosis}*{i,m} = \frac{1}{1024} \sum*{t=1}^{1024} \left( \frac{\mathbf{c}*{i,m}(t) - \mu*{i,m}}{\sigma_{i,m}} \right)^4 - 3 \]其中\( \mu_{i,m} = \frac{1}{1024} \sum_{t=1}^{1024} \mathbf{c}*{i,m}(t) \)（IMF均值），\( \sigma*{i,m} = \sqrt{\frac{1}{1024} \sum_{t=1}^{1024} (\mathbf{c}*{i,m}(t) - \mu*{i,m})^2} \)（IMF标准差）。

**组合特征**：样本\( i \)的25维特征向量为：\[ \mathbf{x}*i = [\text{Peak}*{i,1}, \text{RMS}*{i,1}, ..., \text{Kurtosis}*{i,5}]^\top \]**解释**：5个IMF的5维特征组合，全面捕捉故障的冲击强度、能量分布与分布形态，为CNN提供判别性特征。

###### （3）数据划分模型（分层抽样）
**目标**：保持训练集与测试集的类别分布一致，避免样本偏斜。
1. **统计类别样本数**：对每个故障类型\( k \)，源域样本数\( N_k = \sum_{i=1}^{161} \mathbb{I}(y_i = k) \)（\( \mathbb{I} \)为指示函数，条件满足为1，否则为0）；
2. **分层抽样**：训练集样本数\( N_{\text{train},k} = \lfloor 0.7 \cdot N_k \rfloor \)，测试集样本数\( N_{\text{test},k} = N_k - N_{\text{train},k} \)，组合得到：\[ \mathbf{X}*{\text{train}} = [\mathbf{x}*i | y_i = k, i \in \text{训练集索引}] \]\[ \mathbf{y}*{\text{train}} = [y_i | i \in \text{训练集索引}] \]\[ \mathbf{X}*{\text{test}} = [\mathbf{x}*i | y_i = k, i \in \text{测试集索引}] \]\[ \mathbf{y}*{\text{test}} = [y_i | i \in \text{测试集索引}] \]**解释**：分层抽样保证训练集包含所有类别的足够样本（如“正常”类有\( N_0 \)个样本，训练集取\( \lfloor 0.7 N_0 \rfloor \)个），避免模型因样本偏斜而忽略少数类。

###### （4）特征归一化模型（消除量纲差异）
**目标**：将特征标准化为均值0、方差1，使CNN对所有特征权重公平。用训练集统计量标准化训练集与测试集：
1. **计算训练集统计量**：对第\( f \)维特征（\( f=1,...,25 \)），均值\( \mu_f = \frac{1}{113} \sum_{i=1}^{113} \mathbf{X}*{\text{train}}[i,f] \)，方差\( \sigma_f = \sqrt{\frac{1}{113} \sum*{i=1}^{113} (\mathbf{X}_{\text{train}}[i,f] - \mu_f)^2} \)；
2. **标准化训练集**：\[ \mathbf{X}*{\text{train,scaled}}[i,f] = \frac{\mathbf{X}*{\text{train}}[i,f] - \mu_f}{\sigma_f} \]
3. **标准化测试集**（复用训练集统计量，避免数据泄漏）：\[ \mathbf{X}*{\text{test,scaled}}[i,f] = \frac{\mathbf{X}*{\text{test}}[i,f] - \mu_f}{\sigma_f} \]**解释**：不同特征的量纲不同（如Peak单位为g，CrestFactor无单位），标准化后特征在同一尺度，CNN能公平学习每个特征的权重。

###### （5）EMD-CNN诊断模型（关联学习与概率输出）
**目标**：提取EMD-IMF特征间的关联（如IMF1的峭度与IMF2的峰值交互），输出故障概率分布。模型结构与公式如下：
1. **输入层扩展**：将标准化后的25维特征扩展为1D序列张量（适配1D-CNN）：\[ \mathbf{X}*{\text{input}} = \mathbf{X}*{\text{train,scaled}} \otimes [1] \in \mathbb{R}^{113 \times 25 \times 1} \]（\( \otimes \)为Kronecker乘积，扩展通道数为1）
2. **卷积层（局部特征提取）**：用1D卷积核提取相邻5个特征的关联：\[ \mathbf{C}*1[i,t,c] = \text{ReLU}\left( \sum*{d=0}^4 \mathbf{W}*{\text{conv}}[c,d] \cdot \mathbf{X}*{\text{input}}[i,t+d,1] + \mathbf{b}_{\text{conv}}[c] \right) \]
   - \( i \)：样本索引（1~113）；
   - \( t \)：序列位置（1~21，\( 25-5+1=21 \)）；
   - \( c \)：通道索引（1~64）；
   - \( \mathbf{W}_{\text{conv}} \)：卷积核权重（64×5）；
   - \( \mathbf{b}_{\text{conv}} \)：卷积层偏置（64维）；
   - ReLU激活：引入非线性，避免梯度消失。**输出形状**：\( 113 \times 21 \times 64 \)（113个样本，21个位置，64个通道）。
3. **池化层（特征降维）**：用最大池化保留局部最大值（最具判别性的特征）：\[ \mathbf{P}*1[i,t,c] = \max*{d=0}^1 \mathbf{C}_1[i,2t+d,c] \]
   - \( t \)：池化后位置（1~10，\( \lfloor 21/2 \rfloor = 10 \)）；**输出形状**：\( 113 \times 10 \times 64 \)。
4. **扁平化层（维度转换）**：将2D池化特征转换为1D向量（便于全连接层处理）：\[ \mathbf{P}_{\text{flat}}[i,m] = \mathbf{P}_1[i, \lfloor (m-1)/64 \rfloor + 1, (m-1) \mod 64 + 1] \]
   - \( m \)：扁平化后索引（1~640，\( 10 \times 64 = 640 \)）；**输出形状**：\( 113 \times 640 \)。
5. **全连接层（特征压缩+概率输出）**：
   - **压缩特征**：640维→64维（减少过拟合）：\[ \mathbf{FC}*1[i,n] = \text{ReLU}\left( \sum*{m=1}^{640} \mathbf{W}*{\text{fc1}}[n,m] \cdot \mathbf{P}*{\text{flat}}[i,m] + \mathbf{b}_{\text{fc1}}[n] \right) \]
     - \( n \)：全连接层索引（1~64）；
     - \( \mathbf{W}_{\text{fc1}} \)：全连接层权重（64×640）；
     - \( \mathbf{b}_{\text{fc1}} \)：全连接层偏置（64维）；
   - **输出概率**：64维→4维（4类故障概率），Softmax激活（概率和为1）：\[ \mathbf{y}*{\text{pred}}[i,k] = \frac{\exp\left( \sum*{n=1}^{64} \mathbf{W}*{\text{fc2}}[k,n] \cdot \mathbf{FC}*1[i,n] + \mathbf{b}*{\text{fc2}}[k] \right)}{\sum*{j=0}^3 \exp\left( \sum_{n=1}^{64} \mathbf{W}_{\text{fc2}}[j,n] \cdot \mathbf{FC}*1[i,n] + \mathbf{b}*{\text{fc2}}[j] \right)} \]
     - \( k \)：故障类型索引（0~3）；
     - \( \mathbf{W}_{\text{fc2}} \)：全连接层权重（4×64）；
     - \( \mathbf{b}_{\text{fc2}} \)：全连接层偏置（4维）；**解释**：卷积层提取局部特征（如IMF1的峭度与IMF2的峰值关联），池化层降维，全连接层压缩特征并输出概率，Softmax将输出转换为概率分布，便于分类。

###### （6）模型训练（损失优化）
**目标**：最小化预测概率与真实标签的差异，更新模型参数。
1. **独热编码**：将训练集标签转换为独热矩阵（适应交叉熵损失）：\[ \mathbf{y}*{\text{train,oh}}[i,k] = \mathbb{I}(y*{\text{train}}[i] = k) \]（\( \mathbb{I} \)为指示函数，条件满足为1，否则为0）
2. **交叉熵损失**：量化预测概率与真实标签的差异：\[ L = -\frac{1}{113} \sum_{i=1}^{113} \sum_{k=0}^3 \mathbf{y}*{\text{train,oh}}[i,k] \cdot \log(\mathbf{y}*{\text{pred}}[i,k]) \]
3. **Adam优化器**：自适应更新模型参数（卷积核权重、全连接层权重、偏置）：\[ \theta^{(t+1)} = \theta^{(t)} - 0.001 \cdot \frac{\hat{m}^{(t)}}{\sqrt{\hat{v}^{(t)}} + 10^{-8}} \]
   - \( \theta \)：模型参数集合；
   - \( t \)：迭代次数；
   - \( \hat{m}^{(t)} \)：梯度的指数移动平均（\( \hat{m}^{(t)} = 0.9\hat{m}^{(t-1)} + 0.1g^{(t)} \)）；
   - \( \hat{v}^{(t)} \)：梯度平方的指数移动平均（\( \hat{v}^{(t)} = 0.999\hat{v}^{(t-1)} + 0.001(g^{(t)})^2 \)）；
   - \( g^{(t)} \)：第\( t \)次迭代的梯度；**解释**：交叉熵损失对错误预测的惩罚更大（如预测概率为0.1时，\( \log(0.1) = -2.3 \)，惩罚显著）；Adam优化器结合动量和RMSProp的优点，自适应调整学习率，保证收敛稳定性。

###### （7）模型评价（性能量化）
**目标**：用测试集评估模型的诊断性能，输出多指标结果。
1. **准确率**：正确分类的样本比例（整体性能）：\[ \text{Accuracy} = \frac{1}{48} \sum_{i=1}^{48} \mathbb{I}\left( \arg\max_k \mathbf{y}*{\text{pred,test}}[i,k] = y*{\text{test}}[i] \right) \]（\( \arg\max_k \mathbf{y}_{\text{pred,test}}[i,k] \)为概率最大的故障类型）
2. **精确率**：预测为\( k \)类的样本中实际为\( k \)类的比例（精确性）：\[ \text{Precision}_k = \frac{TP_k}{TP_k + FP_k} \]（\( TP_k \)：真阳性，\( FP_k \)：假阳性）
3. **召回率**：实际为\( k \)类的样本中被正确预测的比例（召回能力）：\[ \text{Recall}_k = \frac{TP_k}{TP_k + FN_k} \]（\( FN_k \)：假阴性）
4. **F1-score**：精确率与召回率的调和平均（综合性能）：\[ \text{F1}_k = 2 \cdot \frac{\text{Precision}_k \cdot \text{Recall}_k}{\text{Precision}_k + \text{Recall}_k} \]
5. **混淆矩阵**：可视化分类错误（行：实际类型，列：预测类型）：\[ \text{CM}[k,j] = \sum_{i=1}^{48} \mathbb{I}\left( y_{\text{test}}[i] = k \land \arg\max_l \mathbf{y}_{\text{pred,test}}[i,l] = j \right) \]**解释**：多指标体系全面量化模型性能，如准确率反映整体诊断能力，F1-score平衡精确率与召回率（适用于不平衡数据集），混淆矩阵直观展示类别混淆情况（如“内圈故障”是否易被误判为“滚动体故障”）。

#### 三、问题二的模型求解算法介绍
问题二的核心是**“EMD时频局部特征提取+CNN关联学习”**，以下是关键算法的原理与核心公式：

##### 1. EMD分解（PyEMD库）
- **原理**：通过“筛选”过程将信号分解为IMF（时频局部化）与残余分量（趋势项），每个IMF满足局部均值为0且极值点-过零点差≤1。
- **核心公式**：同“EMD分解模型”的公式，即\( \mathbf{s}*i(t) = \sum*{m=1}^5 \mathbf{c}*{i,m}(t) + r*{i,5}(t) \)。
- **适配性**：解决全局特征无法捕捉局部故障的问题，聚焦故障冲击的时频特征。

##### 2. 时域特征提取（自定义函数）
- **原理**：对每个IMF提取峰值、RMS、峰值因子、脉冲因子、峭度，量化故障的冲击强度与能量分布。
- **核心公式**：同“IMF特征提取模型”的5维特征公式。
- **适配性**：IMF的时频局部化使这些特征更具判别性，故障冲击会显著改变特征值。

##### 3. StratifiedShuffleSplit（分层抽样，sklearn）
- **原理**：按类别分层，保持训练集与测试集的类别分布一致，避免样本偏斜。
- **核心公式**：\( N_{\text{train},k} = \lfloor 0.7 \cdot N_k \rfloor \)，\( N_{\text{test},k} = N_k - N_{\text{train},k} \)。
- **适配性**：保证模型学习到所有类别的特征，避免因样本偏斜导致的泛化性能下降。

##### 4. StandardScaler（特征标准化，sklearn）
- **原理**：将特征标准化为均值0、方差1，消除量纲差异。
- **核心公式**：\( x_{\text{scaled}} = \frac{x - \mu_f}{\sigma_f} \)（\( \mu_f \)、\( \sigma_f \)为训练集统计量）。
- **适配性**：使CNN对所有特征权重公平，避免量纲影响模型训练。

##### 5. EMD-CNN（Keras/TensorFlow）
- **原理**：用1D-CNN提取EMD-IMF特征间的关联，输出故障概率分布。
- **核心公式**：同“EMD-CNN诊断模型”的卷积层、池化层、全连接层公式。
- **适配性**：捕捉IMF特征间的交互（如IMF1的峭度与IMF2的峰值关联），提升诊断准确性。

#### 四、问题二的模型求解步骤（与数学模型一一对应）
以下步骤基于Python实现，严格对应上述数学模型：

##### 步骤1：准备输入数据
- 读取`Source_Vibration_Signals.csv`，提取：
  - 原始振动信号矩阵\( \mathbf{S} \in \mathbb{R}^{161 \times 1024} \)（161个样本，每个样本1024个采样点）；
  - 标签向量\( \mathbf{y} \in \mathbb{N}^{161 \times 1} \)（0=正常，1=内圈，2=外圈，3=滚动体）。

##### 步骤2：EMD分解与IMF特征提取
1. **EMD分解**：使用PyEMD库的`EMD`类，对每个样本\( \mathbf{s}_i \)分解为5个IMF：
   ```python
   from PyEMD import EMD
   emd = EMD(max_imf=5)
   imfs_list = []
   for s in S:
       imfs, res = emd.decompose(s)  # imfs为5个IMF，res为残余分量
       imfs_list.append(imfs)
   ```
   得到每个样本的5个IMF分量（`imfs_list[i]`为第\( i \)个样本的IMF矩阵，形状\( 5 \times 1024 \)）。
2. **IMF特征提取**：对每个样本的每个IMF，计算5维时域特征：
   ```python
   import numpy as np

   def extract_features(imf):
       peak = np.max(np.abs(imf))
       rms = np.sqrt(np.mean(imf**2))
       crest_factor = peak / rms if rms != 0 else 0
       impulse_factor = peak / np.mean(np.abs(imf)) if np.mean(np.abs(imf)) != 0 else 0
       mu = np.mean(imf)
       sigma = np.std(imf)
       kurtosis = np.mean(((imf - mu)/sigma)**4) - 3 if sigma != 0 else 0
       return [peak, rms, crest_factor, impulse_factor, kurtosis]

   X = []
   for imfs in imfs_list:
       sample_features = []
       for imf in imfs:
           features = extract_features(imf)
           sample_features.extend(features)
       X.append(sample_features)
   X = np.array(X)  # 形状(161, 25)
   ```

##### 步骤3：数据划分（分层抽样）
使用`sklearn.model_selection.StratifiedShuffleSplit`分层抽样：
```python
from sklearn.model_selection import StratifiedShuffleSplit

sss = StratifiedShuffleSplit(n_splits=1, test_size=0.3, random_state=42)
train_idx, test_idx = next(sss.split(X, y))

X_train = X[train_idx]  # 形状(113, 25)
y_train = y[train_idx]  # 形状(113, 1)
X_test = X[test_idx]    # 形状(48, 25)
y_test = y[test_idx]    # 形状(48, 1)
```

##### 步骤4：特征归一化
使用`sklearn.preprocessing.StandardScaler`标准化：
```python
from sklearn.preprocessing import StandardScaler

scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)  # 训练集拟合+标准化
X_test_scaled = scaler.transform(X_test)        # 测试集标准化（复用训练集统计量）
```

##### 步骤5：构建与训练EMD-CNN模型
使用Keras构建1D-CNN：
```python
from tensorflow.keras import layers, models

# 模型构建
model = models.Sequential([
    layers.Input(shape=(25, 1)),  # 输入层：25维序列+1通道
    layers.Conv1D(64, 5, activation='relu'),  # 卷积层：64通道，核5
    layers.MaxPooling1D(2),  # 池化层：窗口2
    layers.Flatten(),  # 扁平化：10×64→640
    layers.Dense(64, activation='relu'),  # 全连接层：640→64
    layers.Dense(4, activation='softmax')  # 输出层：64→4（概率）
])

# 模型编译
model.compile(optimizer='adam',
              loss='sparse_categorical_crossentropy',  # 稀疏交叉熵（整数标签）
              metrics=['accuracy'])

# 模型训练
history = model.fit(X_train_scaled.reshape(-1, 25, 1), y_train,
                    epochs=100,
                    batch_size=32,
                    validation_split=0.1,  # 10%训练集作为验证集
                    shuffle=True,
                    random_state=42)
```

##### 步骤6：模型评价与结果输出
1. **模型预测**：
   ```python
   y_pred_prob = model.predict(X_test_scaled.reshape(-1, 25, 1))
   y_pred = y_pred_prob.argmax(axis=1)  # 取概率最大的故障类型
   ```
2. **计算评价指标**：
   ```python
   from sklearn.metrics import classification_report, confusion_matrix

   print("分类报告：")
   print(classification_report(y_test, y_pred))
   print("混淆矩阵：")
   print(confusion_matrix(y_test, y_pred))
   ```

#### 五、总结
问题二的数学模型通过**“EMD分解→IMF特征提取→CNN关联学习”**的流程，解决了全局特征无法捕捉局部故障的局限性：
1. **EMD分解**：将复杂振动信号分解为IMF（时频局部化）与残余分量（趋势项），聚焦故障冲击；
2. **IMF特征提取**：量化IMF的冲击强度与能量分布，形成25维判别性特征；
3. **EMD-CNN**：提取特征间的关联，输出故障概率分布，提升诊断准确性。

模型的每一步均贴合“时频局部化+关联学习”的核心逻辑，确保捕捉故障的细微特征差异，为源域故障诊断提供精准支持。
