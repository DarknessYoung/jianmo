### 问题二数学模型建立与求解内容

#### 问题二数学模型建立

#### 一、问题二所需的数据文件
问题二的输入数据来自**原始振动信号数据集**`Source_Vibration_Signals.csv`，该文件包含旋转机械（如轴承）的振动信号采集样本，各字段物理意义如下：
- `SampleID`：样本唯一标识（1~161），用于区分不同振动信号样本；
- `Time_Series`：振动信号时间序列（长度为\( N \)的加速度值序列，单位：g），反映旋转机械运行时的振动响应；
- `Label`：故障类型标签（0=正常，1=内圈故障，2=外圈故障，3=滚动体故障），为模型的**监督学习目标**。

#### 二、问题二的变量定义
基于原始振动信号的EMD分解与特征提取结果，定义变量如下（精准描述“EMD-IMF特征-标签”映射关系）：
- **原始振动信号矩阵**：\( \mathbf{S} = [\mathbf{s}*1, \mathbf{s}*2, \dots, \mathbf{s}*{161}]^\top \in \mathbb{R}^{161 \times N} \)，其中\( \mathbf{s}*i = [s*{i,1}, s*{i,2}, \dots, s_{i,N}]^\top \)为第\( i \)个样本的振动信号时间序列（\( N \)为采样点数量，如\( N=1024 \)）；
- **EMD-IMF分量集合**：对每个样本\( \mathbf{s}*i \)，通过EMD分解得到\( M=5 \)个**固有模态函数（IMF）** \( \mathbf{c}*{i,1}, \mathbf{c}*{i,2}, \dots, \mathbf{c}*{i,5} \in \mathbb{R}^N \)和1个残余分量\( \mathbf{r}*{i,5} \in \mathbb{R}^N \)，满足\( \mathbf{s}*i = \sum*{m=1}^5 \mathbf{c}*{i,m} + \mathbf{r}_{i,5} \)；
- **IMF时域特征矩阵**：对每个IMF分量\( \mathbf{c}*{i,m} \)，提取5维时域故障特征（反映IMF的冲击性与能量分布），形成特征向量\( \mathbf{f}*{i,m} = [\text{Peak}*{i,m}, \text{RMS}*{i,m}, \text{CrestFactor}*{i,m}, \text{ImpulseFactor}*{i,m}, \text{Kurtosis}_{i,m}]^\top \in \mathbb{R}^5 \)；
- **源域特征矩阵**：\( \mathbf{X} = [\mathbf{x}*1, \mathbf{x}*2, \dots, \mathbf{x}*{161}]^\top \in \mathbb{R}^{161 \times 25} \)，其中\( \mathbf{x}*i = [\mathbf{f}*{i,1}^\top, \mathbf{f}*{i,2}^\top, \dots, \mathbf{f}_{i,5}^\top]^\top \)为第\( i \)个样本的EMD-IMF组合特征向量（维度\( 5 \times 5 = 25 \)）；
- **源域标签向量**：\( \mathbf{y} = [y_1, y_2, \dots, y_{161}]^\top \in \mathbb{N}^{161 \times 1} \)，其中\( y_i \in \{0,1,2,3\} \)为第\( i \)个样本的故障类型；
- **训练集/测试集特征矩阵**：\( \mathbf{X}*{\text{train}} \in \mathbb{R}^{113 \times 25} \)（源域样本的70%）、\( \mathbf{X}*{\text{test}} \in \mathbb{R}^{48 \times 25} \)（源域样本的30%）；
- **训练集/测试集标签向量**：\( \mathbf{y}*{\text{train}} \in \mathbb{N}^{113 \times 1} \)、\( \mathbf{y}*{\text{test}} \in \mathbb{N}^{48 \times 1} \)；
- **EMD-CNN模型**：\( \mathcal{M}_{\text{EMD-CNN}} \)，输入为标准化后的EMD-IMF特征序列，输出为样本属于各故障类型的概率分布；
- **模型评价指标**：`Metrics`（准确率、精确率、召回率、F1-score、混淆矩阵），量化诊断性能。

#### 三、问题二的参数设置
参数设置需贴合“EMD分解+CNN诊断”的核心逻辑，明确取值依据与业务合理性：

##### 1. EMD分解参数
- **IMF数量**：\( M=5 \)，取值依据：旋转机械振动信号的故障冲击通常集中在5个以内的IMF分量中，分解至第5个IMF时残余分量已呈单调（无波动），保证特征维度一致性；
- **筛选停止准则**：当IMF分量的局部均值趋近于0（包络均值的绝对值≤0.01g）且极值点数量与过零点数量差≤1时，停止筛选。

##### 2. IMF特征提取参数
对每个IMF分量提取5维时域特征（反映故障的冲击性与能量分布）：
- **峰值（Peak）**：\( \text{Peak}*{i,m} = \max*{t=1}^N |\mathbf{c}_{i,m}(t)| \)，反映IMF中的瞬时冲击强度；
- **均方根（RMS）**：\( \text{RMS}*{i,m} = \sqrt{\frac{1}{N} \sum*{t=1}^N \mathbf{c}_{i,m}(t)^2} \)，反映IMF的平均能量水平；
- **峰值因子（CrestFactor）**：\( \text{CrestFactor}*{i,m} = \frac{\text{Peak}*{i,m}}{\text{RMS}_{i,m}} \)，识别IMF中的冲击性（故障时该值显著增大）；
- **脉冲因子（ImpulseFactor）**：\( \text{ImpulseFactor}*{i,m} = \frac{\text{Peak}*{i,m}}{\frac{1}{N} \sum_{t=1}^N |\mathbf{c}_{i,m}(t)|} \)，对周期性冲击（如滚动体故障）更敏感；
- **峭度（Kurtosis）**：\( \text{Kurtosis}*{i,m} = \frac{1}{N} \sum*{t=1}^N \left( \frac{\mathbf{c}*{i,m}(t) - \mu*{i,m}}{\sigma_{i,m}} \right)^4 - 3 \)，其中\( \mu_{i,m} = \frac{1}{N} \sum_{t=1}^N \mathbf{c}*{i,m}(t) \)（IMF均值）、\( \sigma*{i,m} = \sqrt{\frac{1}{N} \sum_{t=1}^N (\mathbf{c}*{i,m}(t) - \mu*{i,m})^2} \)（IMF标准差），反映IMF分布的陡峭程度（故障时因冲击增多而增大）。

##### 3. 数据划分参数
- **训练集占比**：70%（\( N_{\text{train}} = \lfloor 161 \times 0.7 \rfloor = 113 \)）；
- **测试集占比**：30%（\( N_{\text{test}} = 161 - 113 = 48 \)）；
- **分层抽样规则**：对每个故障类型\( k \)，训练集样本数\( N_{\text{train},k} = \lfloor N_k \times 0.7 \rfloor \)，测试集样本数\( N_{\text{test},k} = N_k - N_{\text{train},k} \)，保持类别分布一致；
- **随机种子**：`random_state=42`，保证数据划分可重复。

##### 4. 特征归一化参数
使用`StandardScaler`将EMD-IMF特征标准化为**均值0、方差1**，公式为：\[ x_{\text{scaled}} = \frac{x - \mu_f}{\sigma_f} \]其中\( \mu_f = \frac{1}{113} \sum_{i=1}^{113} \mathbf{X}*{\text{train}}[i,f] \)（训练集第\( f \)维特征均值）、\( \sigma_f = \sqrt{\frac{1}{113} \sum*{i=1}^{113} (\mathbf{X}_{\text{train}}[i,f] - \mu_f)^2} \)（训练集第\( f \)维特征标准差）。取值依据：消除IMF特征的量纲差异（如Peak单位为g，CrestFactor无单位），使CNN对所有特征权重公平。

##### 5. EMD-CNN模型超参数
- **输入层形状**：\( (25, 1) \)，取值依据：将25维EMD-IMF特征视为1D序列（按“IMF1→IMF5”的顺序排列，每个IMF包含5个特征），通道数1（单变量序列）；
- **卷积层**：1D卷积（核大小5，输出通道数64，ReLU激活），取值依据：核大小5可捕捉相邻5个特征的关联（如IMF1的峭度与IMF2的峰值之间的交互），64个通道提取多组局部特征；
- **池化层**：1D最大池化（窗口大小2），取值依据：对卷积后的特征图降维，保留局部最大值（最具判别性的特征），降维后特征长度为\( \lfloor (25-5+1)/2 \rfloor = 10 \)；
- **全连接层**：扁平化后连接2层全连接层（\( 10 \times 64 = 640 \)→64→4），取值依据：640维卷积特征压缩为64维紧凑特征（减少过拟合），最终输出4类故障的概率分布（Softmax激活）；
- **训练参数**：Adam优化器（学习率\( lr=0.001 \)）、交叉熵损失函数、迭代次数\( epochs=100 \)、批次大小\( batch_size=32 \)，取值依据：Adam自适应调整学习率保证收敛稳定性，100轮迭代使模型充分学习特征关联。

#### 四、问题二的约束条件
1. **EMD分解约束**：每个样本的振动信号必须分解为\( M=5 \)个IMF分量（保证特征维度一致性）；
2. **特征提取约束**：对每个IMF分量必须提取完整的5维时域特征（避免特征缺失导致信息损失）；
3. **分层抽样约束**：训练集与测试集的类别分布需与源域一致（\( \frac{N_{\text{train},k}}{N_k} \approx 0.7 \)）；
4. **特征归一化约束**：标准化后的特征均值为0、方差为1；
5. **模型可重复性约束**：所有随机过程（数据划分、模型初始化）设置`random_state=42`；
6. **故障类型平衡约束**：源域中每个故障类型的样本数≥10（保证模型能学习到有效特征）。

#### 五、问题二的完整数学模型公式

##### 1. EMD分解模型（筛选过程）
对第\( i \)个样本的振动信号\( \mathbf{s}*i(t) \)，EMD通过“筛选”得到IMF分量：(1) 拟合上包络\( u_i(t) \)（三次样条插值局部极大值点）与下包络\( l_i(t) \)（三次样条插值局部极小值点）；(2) 计算包络均值\( m_i(t) = \frac{u_i(t) + l_i(t)}{2} \)，得到中间信号\( h_i(t) = \mathbf{s}*i(t) - m_i(t) \)；(3) 重复(1)-(2)直到\( h_i(t) \)满足IMF条件（局部均值≤0.01g、极值点与过零点数量差≤1），此时\( h_i(t) \)即为第一个IMF分量\( \mathbf{c}*{i,1}(t) \)；(4) 计算残余分量\( r*{i,1}(t) = \mathbf{s}*i(t) - \mathbf{c}*{i,1}(t) \)，将\( r_{i,1}(t) \)作为新输入重复上述过程，最终得到5个IMF分量：\[ \mathbf{s}*i(t) = \sum*{m=1}^5 \mathbf{c}*{i,m}(t) + r*{i,5}(t) \]

##### 2. IMF特征提取模型
对第\( i \)个样本的第\( m \)个IMF分量\( \mathbf{c}*{i,m}(t) \)，提取5维时域特征：\[ \text{Peak}*{i,m} = \max_{t=1}^N |\mathbf{c}*{i,m}(t)| \]\[ \text{RMS}*{i,m} = \sqrt{\frac{1}{N} \sum_{t=1}^N \mathbf{c}*{i,m}(t)^2} \]\[ \text{CrestFactor}*{i,m} = \frac{\text{Peak}*{i,m}}{\text{RMS}*{i,m}} \]\[ \text{ImpulseFactor}*{i,m} = \frac{\text{Peak}*{i,m}}{\frac{1}{N} \sum_{t=1}^N |\mathbf{c}*{i,m}(t)|} \]\[ \text{Kurtosis}*{i,m} = \frac{1}{N} \sum_{t=1}^N \left( \frac{\mathbf{c}*{i,m}(t) - \mu*{i,m}}{\sigma_{i,m}} \right)^4 - 3 \]其中\( \mu_{i,m} = \frac{1}{N} \sum_{t=1}^N \mathbf{c}*{i,m}(t) \)、\( \sigma*{i,m} = \sqrt{\frac{1}{N} \sum_{t=1}^N (\mathbf{c}*{i,m}(t) - \mu*{i,m})^2} \)。

组合所有IMF的特征，得到样本\( i \)的特征向量：\[ \mathbf{x}*i = [\text{Peak}*{i,1}, \text{RMS}*{i,1}, \text{CrestFactor}*{i,1}, \text{ImpulseFactor}*{i,1}, \text{Kurtosis}*{i,1}, \dots, \text{Peak}*{i,5}, \text{RMS}*{i,5}, \text{CrestFactor}*{i,5}, \text{ImpulseFactor}*{i,5}, \text{Kurtosis}_{i,5}]^\top \]

##### 3. 数据划分模型（分层抽样）
同原定义，对每个故障类型\( k \)，训练集样本数\( N_{\text{train},k} = \lfloor N_k \times 0.7 \rfloor \)，测试集样本数\( N_{\text{test},k} = N_k - N_{\text{train},k} \)，组合得到\( \mathbf{X}*{\text{train}}、\mathbf{y}*{\text{train}}、\mathbf{X}*{\text{test}}、\mathbf{y}*{\text{test}} \)。

##### 4. 特征归一化模型（StandardScaler）
同原定义，用训练集统计量标准化训练集与测试集：\[ \mathbf{X}*{\text{train,scaled}}[i,f] = \frac{\mathbf{X}*{\text{train}}[i,f] - \mu_f}{\sigma_f} \]\[ \mathbf{X}*{\text{test,scaled}}[i,f] = \frac{\mathbf{X}*{\text{test}}[i,f] - \mu_f}{\sigma_f} \]

##### 5. EMD-CNN诊断模型
(1) **输入层扩展**：将标准化后的特征扩展为1D序列张量（适配1D-CNN输入）：\[ \mathbf{X}*{\text{input}} = \mathbf{X}*{\text{train,scaled}} \otimes [1] \in \mathbb{R}^{113 \times 25 \times 1} \]其中\( \otimes \)为Kronecker乘积（扩展通道数）。

(2) **卷积层（局部特征提取）**：\[ \mathbf{C}*1[i, t, c] = \text{ReLU}\left( \sum*{d=0}^4 \mathbf{W}*{\text{conv}}[c, d] \cdot \mathbf{X}*{\text{input}}[i, t+d, 1] + \mathbf{b}_{\text{conv}}[c] \right) \]
- \( i \)：样本索引（1~113）；
- \( t \)：序列位置（1~21，\( 25-5+1=21 \)）；
- \( c \)：通道索引（1~64）；
- \( \mathbf{W}_{\text{conv}} \in \mathbb{R}^{64 \times 5} \)：卷积核权重；
- \( \mathbf{b}_{\text{conv}} \in \mathbb{R}^{64} \)：卷积层偏置；
- 输出形状：\( 113 \times 21 \times 64 \)。

(3) **池化层（特征降维）**：\[ \mathbf{P}*1[i, t, c] = \max*{d=0}^1 \mathbf{C}_1[i, 2t+d, c] \]
- \( t \)：池化后位置（1~10，\( \lfloor 21/2 \rfloor = 10 \)）；
- 输出形状：\( 113 \times 10 \times 64 \)。

(4) **扁平化层（维度转换）**：\[ \mathbf{P}_{\text{flat}}[i, m] = \mathbf{P}_1[i, \lfloor (m-1)/64 \rfloor + 1, (m-1) \mod 64 + 1] \]
- \( m \)：扁平化后索引（1~640，\( 10 \times 64 = 640 \)）；
- 输出形状：\( 113 \times 640 \)。

(5) **全连接层（特征压缩与概率预测）**：
- 第1全连接层（压缩特征）：\[ \mathbf{FC}*1[i, n] = \text{ReLU}\left( \sum*{m=1}^{640} \mathbf{W}*{\text{fc1}}[n, m] \cdot \mathbf{P}*{\text{flat}}[i, m] + \mathbf{b}_{\text{fc1}}[n] \right) \]
  - \( n \)：全连接层1索引（1~64）；
  - \( \mathbf{W}_{\text{fc1}} \in \mathbb{R}^{64 \times 640} \)：全连接层1权重；
  - \( \mathbf{b}_{\text{fc1}} \in \mathbb{R}^{64} \)：全连接层1偏置；
  - 输出形状：\( 113 \times 64 \)。

- 输出层（概率预测）：\[ \mathbf{y}*{\text{pred}}[i, k] = \frac{\exp\left( \sum*{n=1}^{64} \mathbf{W}*{\text{fc2}}[k, n] \cdot \mathbf{FC}*1[i, n] + \mathbf{b}*{\text{fc2}}[k] \right)}{\sum*{j=0}^3 \exp\left( \sum_{n=1}^{64} \mathbf{W}_{\text{fc2}}[j, n] \cdot \mathbf{FC}*1[i, n] + \mathbf{b}*{\text{fc2}}[j] \right)} \]
  - \( k \)：故障类型索引（0~3）；
  - \( \mathbf{W}_{\text{fc2}} \in \mathbb{R}^{4 \times 64} \)：全连接层2权重；
  - \( \mathbf{b}_{\text{fc2}} \in \mathbb{R}^{4} \)：全连接层2偏置；
  - 输出形状：\( 113 \times 4 \)（4类故障的概率分布）。

##### 6. 模型训练（损失函数与优化）
- **独热编码**：将训练集标签转换为独热矩阵\( \mathbf{y}*{\text{train,oh}}[i, k] = \mathbb{I}(y*{\text{train}}[i] = k) \)（\( \mathbb{I} \)为指示函数）；
- **交叉熵损失**：量化预测概率与真实标签的差异：\[ L = -\frac{1}{113} \sum_{i=1}^{113} \sum_{k=0}^3 \mathbf{y}*{\text{train,oh}}[i, k] \cdot \log(\mathbf{y}*{\text{pred}}[i, k]) \]
- **Adam优化器**：自适应更新模型参数（卷积核权重、全连接层权重、偏置）：\[ \theta^{(t+1)} = \theta^{(t)} - 0.001 \cdot \frac{\hat{m}^{(t)}}{\sqrt{\hat{v}^{(t)}} + 10^{-8}} \]
  - \( \theta \)：模型参数集合；
  - \( t \)：迭代次数；
  - \( \hat{m}^{(t)} \)：梯度的指数移动平均；
  - \( \hat{v}^{(t)} \)：梯度平方的指数移动平均。

##### 7. 模型评价（多指标体系）
同原定义，包括准确率、精确率、召回率、F1-score与混淆矩阵，公式如下：
- **准确率**：\( \text{Accuracy} = \frac{1}{48} \sum_{i=1}^{48} \mathbb{I}\left( \arg\max_k \mathbf{y}*{\text{pred,test}}[i,k] = y*{\text{test}}[i] \right) \)；
- **精确率**：\( \text{Precision}_k = \frac{TP_k}{TP_k + FP_k} \)（\( TP_k \)：真阳性数，\( FP_k \)：假阳性数）；
- **召回率**：\( \text{Recall}_k = \frac{TP_k}{TP_k + FN_k} \)（\( FN_k \)：假阴性数）；
- **F1-score**：\( \text{F1}_k = 2 \cdot \frac{\text{Precision}_k \cdot \text{Recall}_k}{\text{Precision}_k + \text{Recall}_k} \)；
- **混淆矩阵**：\( \text{CM}*{k,j} = \sum*{i=1}^{48} \mathbb{I}\left( y_{\text{test}}[i] = k \land \arg\max_l \mathbf{y}_{\text{pred,test}}[i,l] = j \right) \)。

#### 六、总结
问题二的数学模型通过**“EMD分解→IMF特征提取→CNN关联学习”**的流程，解决了原模型仅使用全局特征无法捕捉局部故障信息的局限性：
1. **EMD分解**：将复杂振动信号分解为局部化的IMF分量，聚焦故障的时频冲击特征；
2. **IMF特征提取**：提取IMF的时域特征，放大故障冲击的判别性；
3. **EMD-CNN模型**：通过1D-CNN提取IMF特征间的关联（如不同IMF的峭度与峰值交互），有效识别故障类型。

模型的每一步均贴合“时频局部化+关联学习”的核心逻辑，确保能精准捕捉故障信号的细微特征差异，提升源域故障诊断的准确性。

### 问题二模型求解框架与详细步骤

#### 一、问题二模型求解算法介绍
问题二的核心是**“EMD的时频局部特征提取+CNN的关联学习”**，推荐算法及适配性如下：

##### 1. EMD分解（PyEMD库）
- **原理**：通过筛选过程将振动信号分解为IMF分量（时频局部化），每个IMF反映信号的局部频率成分；
- **适配性**：解决原模型全局特征无法捕捉局部故障的问题，聚焦故障的冲击性特征。

##### 2. 时域特征提取（自定义函数）
- **原理**：对每个IMF提取峰值、RMS、峰值因子、脉冲因子、峭度5维特征，反映IMF的冲击强度与能量分布；
- **适配性**：IMF的时频局部化使时域特征更具判别性（故障冲击会增强IMF的峰值与峭度）。

##### 3. StratifiedShuffleSplit（分层抽样，sklearn）
- **原理**：按故障类型分层抽样，保持训练集与测试集的类别分布一致；
- **适配性**：避免因样本偏斜导致模型偏倚。

##### 4. StandardScaler（特征标准化，sklearn）
- **原理**：消除IMF特征的量纲差异，使CNN对所有特征权重公平；
- **适配性**：保证模型训练的稳定性。

##### 5. Keras/TensorFlow构建EMD-CNN（故障诊断模型）
- **原理**：适配EMD-IMF特征的25维序列，通过1D-CNN提取局部关联，输出故障概率；
- **适配性**：捕捉IMF特征间的交互，提升诊断准确性。

#### 二、问题二模型求解详细步骤

##### 步骤1：准备输入数据
- 输入数据：`Source_Vibration_Signals.csv`，包含161个样本的振动信号时间序列与故障标签；
- 变量定义：原始振动信号矩阵\( \mathbf{S} \in \mathbb{R}^{161 \times 1024} \)（假设采样点\( N=1024 \)），标签向量\( \mathbf{y} \in \mathbb{N}^{161 \times 1} \)。

##### 步骤2：EMD分解与IMF特征提取
1. **EMD分解**：使用PyEMD库的`EMD`类对每个样本的振动信号分解为5个IMF分量：\[ \mathbf{c}*{i,1}, \mathbf{c}*{i,2}, \dots, \mathbf{c}_{i,5} = \text{EMD}(\mathbf{s}_i, max_imf=5) \]
2. **IMF特征提取**：对每个IMF分量计算5维时域特征，组合形成EMD-IMF特征矩阵\( \mathbf{X} \in \mathbb{R}^{161 \times 25} \)。

##### 步骤3：数据划分（分层抽样）
- 统计源域中每个故障类型的样本数\( N_k = \sum_{i=1}^{161} \mathbb{I}(y_i = k) \)；
- 对每个故障类型\( k \)，抽取\( N_{\text{train},k} = \lfloor N_k \times 0.7 \rfloor \)个样本组成训练集，剩余\( N_{\text{test},k} = N_k - N_{\text{train},k} \)个样本组成测试集；
- 设置`random_state=42`保证结果可重复，生成\( \mathbf{X}*{\text{train}}、\mathbf{y}*{\text{train}}、\mathbf{X}*{\text{test}}、\mathbf{y}*{\text{test}} \)。

##### 步骤4：特征标准化
- 用训练集\( \mathbf{X}_{\text{train}} \)拟合`StandardScaler`，计算每个特征维度的均值\( \mu_f \)与标准差\( \sigma_f \)；
- 标准化训练集：\( \mathbf{X}*{\text{train,scaled}}[i,f] = \frac{\mathbf{X}*{\text{train}}[i,f] - \mu_f}{\sigma_f} \)；
- 标准化测试集：\( \mathbf{X}*{\text{test,scaled}}[i,f] = \frac{\mathbf{X}*{\text{test}}[i,f] - \mu_f}{\sigma_f} \)（复用训练集的\( \mu_f \)与\( \sigma_f \)）。

##### 步骤5：构建与训练EMD-CNN模型
1. **模型构建**：使用Keras构建EMD-CNN模型：
   ```python
   from tensorflow.keras import layers, models

   model = models.Sequential([
       layers.Input(shape=(25, 1)),  # 输入层：25维EMD-IMF特征序列
       layers.Conv1D(64, 5, activation='relu'),  # 卷积层：核大小5，64通道
       layers.MaxPooling1D(2),  # 池化层：窗口大小2
       layers.Flatten(),  # 扁平化层：640维
       layers.Dense(64, activation='relu'),  # 全连接层1：640→64
       layers.Dense(4, activation='softmax')  # 输出层：64→4（4类故障概率）
   ])
   ```
2. **模型编译**：设置优化器与损失函数：
   ```python
   model.compile(optimizer='adam',
                 loss='sparse_categorical_crossentropy',  # 标签为整数时使用
                 metrics=['accuracy'])
   ```
3. **模型训练**：输入标准化后的训练集特征与标签，训练100轮：
   ```python
   history = model.fit(X_train_scaled, y_train,
                       epochs=100,
                       batch_size=32,
                       validation_split=0.1,  # 10%训练集作为验证集
                       shuffle=True,
                       random_state=42)
   ```

##### 步骤6：模型评价与结果输出
1. **模型预测**：用训练好的模型预测测试集特征，得到概率矩阵\( \mathbf{y}_{\text{pred,test}} \)：
   ```python
   y_pred_prob = model.predict(X_test_scaled)
   y_pred = y_pred_prob.argmax(axis=1)  # 取概率最大的故障类型
   ```
2. **计算评价指标**：使用sklearn库计算准确率、精确率、召回率、F1-score与混淆矩阵：
   ```python
   from sklearn.metrics import classification_report, confusion_matrix

   print("分类报告：")
   print(classification_report(y_test, y_pred))
   print("混淆矩阵：")
   print(confusion_matrix(y_test, y_pred))
   ```

#### 三、问题二模型求解输出内容
1. **EMD分解结果**：每个样本的5个IMF分量可视化（如IMF1~IMF5的时间序列图）；
2. **EMD-IMF特征矩阵**：161×25的特征矩阵（包含每个样本的IMF时域特征）；
3. **数据划分结果**：训练集（113样本）与测试集（48样本）的类别分布；
4. **训练好的EMD-CNN模型**：模型结构（输入层→卷积层→池化层→扁平化层→全连接层→输出层）与超参数；
5. **模型评价结果**：测试集的准确率、精确率、召回率、F1-score与混淆矩阵；
6. **性能可视化**：模型训练曲线（损失随迭代次数的变化）、EMD-IMF特征重要性排序（卷积层权重可视化）。

综上，调整后的模型通过EMD捕捉故障的时频局部特征，结合CNN提取特征关联，有效提升了源域故障诊断的准确性，解决了原模型仅使用全局特征的局限性。
